<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&#9889; Devon's Morning Update Dashboard</title>
    
    <!-- Force fresh data - no caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 75%, #475569 100%);
            color: #f8fafc;
            line-height: 1.6;
            min-height: 100vh;
            padding: 1rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            background: linear-gradient(135deg, #60a5fa, #34d399, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .status-indicator {
            display: inline-block;
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .date-display {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        /* RETRO FLIP CLOCK STYLES */
        .flip-clock-container {
            text-align: center;
            margin: 2rem 0;
            padding: 2rem;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .flip-clock {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'Courier New', monospace;
        }

        .flip-digit {
            background: linear-gradient(to bottom, #333 0%, #222 50%, #111 100%);
            color: white;
            font-size: 4rem;
            font-weight: bold;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.3);
            position: relative;
            min-width: 5rem;
            text-align: center;
            transition: all 0.6s ease;
            border: 2px solid #444;
        }

        .flip-digit::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #444;
            z-index: 2;
        }

        .flip-separator {
            color: white;
            font-size: 3rem;
            font-weight: bold;
            animation: blink 2s infinite;
            margin: 0 0.5rem;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .flip-ampm {
            background: #f59e0b;
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            margin-left: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* GRID LAYOUT */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .clickable-header {
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            transition: all 0.2s ease;
        }

        .clickable-header:hover {
            color: #60a5fa;
            text-decoration: none;
        }

        /* WEATHER STYLES - NEON BLUE */
        .weather-card {
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%) !important;
            color: white;
        }

        .weather-main {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .weather-emoji {
            font-size: 3rem;
        }

        .weather-temp {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .weather-condition {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .sun-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        .sun-item {
            text-align: center;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .sun-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .sun-time {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .sun-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* CALENDAR STYLES - BLACK GRADIENT */
        .calendar-card {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: white;
        }

        /* TASKS STYLES - BLACK GRADIENT */
        .tasks-card {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: white;
        }

        /* TASK AND EVENT STYLES */
        .task-item, .event-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 4px solid rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
        }

        .task-item:hover, .event-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .task-content, .event-content {
            flex: 1;
        }

        .task-actions, .event-actions {
            display: flex;
            gap: 0.5rem;
        }

        .add-task-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .add-task-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        /* CRYPTO STYLES */
        .crypto-section {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 2rem 0;
        }

        .crypto-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .crypto-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            display: block;
            cursor: pointer;
        }

        .crypto-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .swing-item {
            border-left: 4px solid #3b82f6;
        }

        .moonshot-item {
            border-left: 4px solid #f59e0b;
        }

        .macro-item {
            border-left: 4px solid #10b981;
        }

        .arsenal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .arsenal-link {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 1rem;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .arsenal-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .crypto-grid {
                grid-template-columns: 1fr;
            }
            .flip-digit {
                font-size: 2.5rem;
                padding: 0.75rem 1rem;
            }
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container" style="max-width: 1400px; margin: 0 auto;">
        <div class="header">
            <h1>&#9889; Devon's Morning Update Dashboard</h1>
            <div class="date-display" id="current-date">Loading...</div>
        </div>

        <!-- RETRO FLIP CLOCK -->
        <div class="flip-clock-container">
            <div class="flip-clock">
                <div class="flip-digit" id="hour1">0</div>
                <div class="flip-digit" id="hour2">0</div>
                <div class="flip-separator">:</div>
                <div class="flip-digit" id="min1">0</div>
                <div class="flip-digit" id="min2">0</div>
                <div class="flip-ampm" id="ampm">AM</div>
            </div>
            <div style="margin-top: 1rem; color: rgba(255, 255, 255, 0.8);">Pacific Time &#8226; Live Updates</div>
        </div>

        <div class="dashboard-grid">
            <!-- WEATHER -->
            <div class="card weather-card" style="background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%) !important;">
                <h2>&#127780; Kelowna Weather</h2>
                <div class="weather-main">
                    <div class="weather-emoji">&#127769;</div>
                    <div>
                        <div class="weather-temp" id="weather-temp">3&deg;C</div>
                        <div class="weather-condition">Partly Cloudy</div>
                    </div>
                </div>
                <div class="sun-info">
                    <div class="sun-item">
                        <div class="sun-icon">&#127749;</div>
                        <div class="sun-time" id="sunrise-time">7:42 AM</div>
                        <div class="sun-label">Sunrise</div>
                    </div>
                    <div class="sun-item">
                        <div class="sun-icon">&#127751;</div>
                        <div class="sun-time" id="sunset-time">5:18 PM</div>
                        <div class="sun-label">Sunset</div>
                    </div>
                </div>
            </div>

            <!-- CALENDAR -->
            <div class="card calendar-card">
                <h2 style="display: flex; justify-content: space-between; align-items: center;">
                    <a href="https://calendar.google.com/calendar/u/0/r/today" target="_blank" class="clickable-header" style="color: white; text-decoration: none;">
                        &#128197; Google Calendar
                    </a>
                    <button onclick="loadCalendarEvents()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.3rem 0.6rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">&#128260;</button>
                </h2>
                <div id="calendar-events">
                    <div style="color: rgba(255,255,255,0.7); font-style: italic;">&#128260; Loading calendar & refreshing tokens...</div>
                </div>
            </div>

            <!-- TASKS -->
            <div class="card tasks-card">
                <h2 style="display: flex; justify-content: space-between; align-items: center;">
                    <a href="https://tasks.google.com/embed/?origin=https://calendar.google.com&fullWidth=1" target="_blank" class="clickable-header" style="color: white; text-decoration: none;">
                        &#128221; Google Tasks
                    </a>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="loadTasks()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.3rem 0.6rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">&#128260;</button>
                        <button class="add-task-btn" onclick="showAddTaskModal()">+ Add Task</button>
                    </div>
                </h2>
                <div id="task-list">
                    <div style="color: rgba(255,255,255,0.7); font-style: italic;">&#128260; Loading tasks & refreshing tokens...</div>
                </div>
            </div>
        </div>

        <!-- CRYPTO INTELLIGENCE SECTION -->
        <div class="crypto-section">
            <h2 style="color: white; margin-bottom: 2rem; text-align: center; font-size: 1.6rem; font-weight: 600;">&#128640; Expert Crypto Intelligence</h2>
            
            <!-- Daily Check Arsenal -->
            <div style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); padding: 1.5rem; border-radius: 16px; margin-bottom: 2rem; box-shadow: 0 8px 32px rgba(255, 107, 53, 0.3); border: 1px solid rgba(255, 107, 53, 0.3);">
                <h3 style="color: white; margin: 0 0 1.5rem 0; font-size: 1.1rem; font-weight: 600;">&#128295; Daily Check Arsenal</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;">
                    <a href="https://www.tradingview.com/chart/?symbol=BTCUSDT" target="_blank" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1rem; border-radius: 12px; text-decoration: none; color: white; font-weight: 600; transition: all 0.3s ease; display: block; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">
                        <div style="font-weight: 600; font-size: 0.95rem; margin-bottom: 0.3rem; color: white;">&#128200; TradingView</div>
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Bitcoin chart + 200/35 EMA</div>
                    </a>
                    
                    <a href="https://banterbubbles.com" target="_blank" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1rem; border-radius: 12px; text-decoration: none; color: white; font-weight: 600; transition: all 0.3s ease; display: block; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">
                        <div style="font-weight: 600; font-size: 0.95rem; margin-bottom: 0.3rem; color: white;">&#128172; Banter Bubbles</div>
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Social sentiment tracker</div>
                    </a>
                    
                    <a href="https://coinmarketcap.com" target="_blank" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1rem; border-radius: 12px; text-decoration: none; color: white; font-weight: 600; transition: all 0.3s ease; display: block; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">
                        <div style="font-weight: 600; font-size: 0.95rem; margin-bottom: 0.3rem; color: white;">&#128176; CoinMarketCap</div>
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Market data & rankings</div>
                    </a>
                    
                    <a href="https://cointelegraph.com/category/latest-news" target="_blank" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1rem; border-radius: 12px; text-decoration: none; color: white; font-weight: 600; transition: all 0.3s ease; display: block; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">
                        <div style="font-weight: 600; font-size: 0.95rem; margin-bottom: 0.3rem; color: white;">&#128240; CoinTelegraph</div>
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Latest crypto news</div>
                    </a>
                    
                    <a href="https://cryptopanic.com" target="_blank" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1rem; border-radius: 12px; text-decoration: none; color: white; font-weight: 600; transition: all 0.3s ease; display: block; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">
                        <div style="font-weight: 600; font-size: 0.95rem; margin-bottom: 0.3rem; color: white;">&#128240; CryptoPanic</div>
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">News aggregator</div>
                    </a>
                    
                    <a href="https://www.cookie.fun" target="_blank" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1rem; border-radius: 12px; text-decoration: none; color: white; font-weight: 600; transition: all 0.3s ease; display: block; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">
                        <div style="font-weight: 600; font-size: 0.95rem; margin-bottom: 0.3rem; color: white;">&#127850; Cookie.fun</div>
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Portfolio analytics</div>
                    </a>
                </div>
            </div>

            <!-- Market Overview -->
            <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 1.5rem; border-radius: 16px; margin-bottom: 2rem; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); border: 1px solid rgba(148, 163, 184, 0.2);">
                <h3 style="color: #f1f5f9; margin: 0 0 1rem 0; font-size: 1.2rem; font-weight: 600;">&#128202; Market Pulse</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 1rem;">
                    <div id="btc-market-data" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); color: white; font-weight: 600;">
                        <div style="font-size: 0.9rem; color: white; margin-bottom: 0.5rem; font-weight: 500;">Bitcoin</div>
                        <div id="btc-price-live" style="font-size: 1.2rem; font-weight: 600; color: white;">Loading...</div>
                        <div id="btc-change-live" style="font-size: 0.8rem; color: white;">Loading...</div>
                    </div>
                    <div id="fear-greed-data" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); color: white; font-weight: 600;">
                        <div style="font-size: 0.9rem; color: white; margin-bottom: 0.5rem; font-weight: 500;">Fear/Greed</div>
                        <div id="fear-greed-value" style="font-size: 1.2rem; font-weight: 600; color: white;">Loading...</div>
                        <div id="fear-greed-text" style="font-size: 0.8rem; color: white;">Loading...</div>
                    </div>
                    <div id="ema-status" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1rem; border-radius: 12px; text-align: center; cursor: pointer; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); color: white; font-weight: 600;">
                        <div style="font-size: 0.9rem; color: white; margin-bottom: 0.5rem; font-weight: 500;">200 EMA</div>
                        <div id="ema-bias" style="font-size: 1.2rem; font-weight: 600; color: white;">Loading...</div>
                        <div id="ema-signal" style="font-size: 0.8rem; color: white;">Loading...</div>
                    </div>
                    <div onclick="showMacroCharts()" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1rem; border-radius: 12px; text-align: center; cursor: pointer; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); color: white; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                        <div style="font-size: 0.9rem; color: white; margin-bottom: 0.5rem; font-weight: 500;">üìä Macro Dashboard</div>
                        <div style="font-size: 1.2rem; font-weight: 600; color: #10b981;">LIVE CHARTS</div>
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Click for macro analysis</div>
                    </div>
                </div>
            </div>

            <!-- CRITICAL NEWS SECTION - BEFORE MAINSTREAM KNOWS -->
            <div style="background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%); padding: 1.5rem; border-radius: 16px; margin-bottom: 2rem; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); border: 1px solid rgba(148, 163, 184, 0.2);">
                <h3 style="color: #f1f5f9; margin: 0 0 1.5rem 0; font-size: 1.1rem; font-weight: 600;">&#128240; Critical Intelligence - Before Mainstream Knows</h3>
                
                <div id="critical-news">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; cursor: pointer;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem; color: #fbbf24;">&#9889; Token Unlocks (Next 7 Days)</div>
                            <div id="token-unlocks" style="font-size: 0.9rem;">Loading critical unlock data...</div>
                        </div>

                        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; cursor: pointer;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem; color: #fbbf24;">&#127967; Fed & Economic Events</div>
                            <div id="fed-events" style="font-size: 0.9rem;">Loading policy intelligence...</div>
                        </div>

                        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; cursor: pointer;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem; color: #fbbf24;">&#127970; Institutional Moves</div>
                            <div id="institutional-moves" style="font-size: 0.9rem;">Loading smart money intelligence...</div>
                        </div>

                        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; cursor: pointer;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem; color: #fbbf24;">&#128302; Emerging Narratives</div>
                            <div id="emerging-narratives" style="font-size: 0.9rem;">Loading narrative intelligence...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LIVE CRYPTO OPPORTUNITIES -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                
                <!-- SWING TRADING - Bitcoin Outperformance (500+ Coins) -->
                <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 1.5rem; border-radius: 16px; margin-bottom: 2rem; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); border: 1px solid rgba(148, 163, 184, 0.2);">
                    <h3 style="color: #f1f5f9; margin: 0 0 1.5rem 0; font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; justify-content: space-between;">
                        &#128200; Swing Trading Opportunities
                        <span id="swing-status" style="background: rgba(255, 255, 255, 0.2); color: white; padding: 0.3rem 0.8rem; border-radius: 8px; font-size: 0.8rem; font-weight: 600;">Scanning...</span>
                    </h3>
                    
                    <div id="live-swing-opportunities">
                        <div id="swing-loading" style="text-align: center; padding: 2rem; opacity: 0.7;">
                            <div style="font-size: 1rem; margin-bottom: 0.5rem;">üìä Massive Bitcoin outperformance scan...</div>
                            <div style="font-size: 0.8rem;">Scanning 500+ coins for 200 EMA bias + outperformance patterns</div>
                        </div>
                        <div id="swing-content" style="display: none;"></div>
                    </div>
                </div>

                <!-- LIVE Social Intelligence -->
                <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 1.5rem; border-radius: 16px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); border: 1px solid rgba(148, 163, 184, 0.2);">
                    <h3 style="color: #f1f5f9; margin: 0 0 1.5rem 0; font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; justify-content: space-between;">
                        &#127769; Social Sentiment Moonshots
                        <span id="social-status" style="background: rgba(255, 255, 255, 0.2); color: white; padding: 0.3rem 0.8rem; border-radius: 8px; font-size: 0.8rem; font-weight: 600;">Scanning...</span>
                    </h3>
                    
                    <div id="live-social-opportunities">
                        <div id="moonshot-loading" style="text-align: center; padding: 2rem; opacity: 0.7;">
                            <div style="font-size: 1rem; margin-bottom: 0.5rem;">üîç Social sentiment scanning...</div>
                            <div style="font-size: 0.8rem;">Finding coins with growing discussion before viral breakouts</div>
                        </div>
                        <div id="moonshot-content" style="display: none;"></div>
                    </div>
                </div>
            </div>


            <!-- Advanced Tools Link -->
            <div style="text-align: center; margin-top: 2rem; margin-bottom: 2rem;">
                <button id="advanced-tools-btn" onclick="editAdvancedToolLink()" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color: white; padding: 1rem 2rem; border: none; border-radius: 12px; font-weight: 600; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 16px rgba(255, 107, 53, 0.3); transition: all 0.3s ease;">
                    &#128295; Advanced Trading Tools
                </button>
            </div>
        </div>

        <div style="margin-bottom: 2rem;">
            <h2 style="color: white; margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                &#129504; Learning & Memory Mastery
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <button onclick="showProgressTree()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.3rem 0.6rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">&#127795; Progress Tree</button>
                    <button onclick="clearLearningData()" style="background: rgba(255,100,100,0.6); border: none; color: white; padding: 0.3rem 0.6rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">&#128260; Fresh Start</button>
                </div>
            </h2>
            
            <!-- Gamification Stats -->
            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; font-size: 0.95rem;">
                <div style="background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); padding: 0.8rem 1.2rem; border-radius: 12px; color: white; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3); font-weight: 600;">
                    <span id="learning-level">Level 1 - Beginner Speaker</span>
                </div>
                <div style="background: linear-gradient(135deg, #10b981 0%, #047857 100%); padding: 0.8rem 1.2rem; border-radius: 12px; color: white; box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3); font-weight: 600;">
                    <span id="learning-xp">0 XP</span>
                </div>
                <div style="background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 100%); padding: 0.8rem 1.2rem; border-radius: 12px; color: white; box-shadow: 0 4px 20px rgba(168, 85, 247, 0.3); font-weight: 600;">
                    <span id="learning-streak">0 day streak</span>
                </div>
            </div>

            <!-- Three Horizontal Flashcards -->
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <!-- Bible Verse Card -->
                <div class="learning-card" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1.5rem; border-radius: 16px; position: relative; min-height: 200px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="position: relative; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: center; align-items: center;">
                            <button onclick="previousBibleCard()" style="background: rgba(255, 255, 255, 0.2); border: none; color: white; padding: 0.5rem; border-radius: 50%; cursor: pointer; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; margin-right: 1rem;">&#8592;</button>
                            <h3 style="margin: 0; color: white; font-size: 1.2rem; font-weight: 600;">&#128214; Bible Verse</h3>
                            <button onclick="nextBibleCard()" style="background: rgba(255, 255, 255, 0.2); border: none; color: white; padding: 0.5rem; border-radius: 50%; cursor: pointer; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; margin-left: 1rem;">&#8594;</button>
                        </div>
                        <button onclick="showAddVerseModal()" style="position: absolute; top: 0; right: 0; background: rgba(255,255,255,0.25); border: none; color: white; padding: 0.4rem 0.8rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500;">+ Add</button>
                    </div>
                    
                    <div id="bible-verse-content" style="text-align: center; display: flex; flex-direction: column; justify-content: center; height: 120px; color: white;">
                        <div style="font-size: 0.9rem; margin-bottom: 0.5rem; opacity: 0.8; color: white;">Jeremiah 29:11</div>
                        <div style="font-weight: 600; line-height: 1.4; color: white;">"For I know the plans I have for you," declares the Lord, "plans to prosper you and not to harm you, to give you hope and a future."</div>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button onclick="reviewBible('struggling')" style="flex: 1; background: rgba(255,87,87,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Struggling</button>
                        <button onclick="reviewBible('getting-it')" style="flex: 1; background: rgba(255,152,0,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Getting It</button>
                        <button onclick="reviewBible('got-it')" style="flex: 1; background: rgba(76,175,80,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Got It</button>
                        <button onclick="reviewBible('mastered')" style="flex: 1; background: rgba(0,200,150,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Mastered</button>
                    </div>
                </div>

                <!-- Vocabulary Card -->
                <div class="learning-card" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1.5rem; border-radius: 16px; position: relative; min-height: 200px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="position: relative; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: center; align-items: center;">
                            <button onclick="previousVocabCard()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem; border-radius: 50%; cursor: pointer; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; margin-right: 1rem;">&#8592;</button>
                            <h3 style="margin: 0; color: white; font-size: 1.2rem; font-weight: 600;">&#128218; Vocabulary</h3>
                            <button onclick="nextVocabCard()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem; border-radius: 50%; cursor: pointer; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; margin-left: 1rem;">&#8594;</button>
                        </div>
                        <button onclick="showAddVocabModal()" style="position: absolute; top: 0; right: 0; background: rgba(255,255,255,0.25); border: none; color: white; padding: 0.4rem 0.8rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500;">+ Add</button>
                    </div>
                    
                    <div id="vocabulary-content" style="text-align: center; display: flex; flex-direction: column; justify-content: center; height: 120px;">
                        <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.8rem; cursor: pointer;" onclick="openDictionary('articulate')" title="Click for pronunciation">
                            articulate &#128266;
                        </div>
                        <div style="font-size: 0.9rem; margin-bottom: 0.5rem; line-height: 1.4;">Having or showing the ability to speak fluently and coherently</div>
                        <div style="font-size: 0.8rem; opacity: 0.8; font-style: italic;">"She was very articulate in explaining her position during the debate."</div>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button onclick="reviewVocab('struggling')" style="flex: 1; background: rgba(255,87,87,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Struggling</button>
                        <button onclick="reviewVocab('getting-it')" style="flex: 1; background: rgba(255,152,0,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Getting It</button>
                        <button onclick="reviewVocab('got-it')" style="flex: 1; background: rgba(76,175,80,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Got It</button>
                        <button onclick="reviewVocab('mastered')" style="flex: 1; background: rgba(0,200,150,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Mastered</button>
                    </div>
                </div>

                <!-- Facts Card -->
                <div class="learning-card" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 1.5rem; border-radius: 16px; position: relative; min-height: 200px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="position: relative; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: center; align-items: center;">
                            <button onclick="previousFactCard()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem; border-radius: 50%; cursor: pointer; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; margin-right: 1rem;">&#8592;</button>
                            <h3 style="margin: 0; color: white; font-size: 1.2rem; font-weight: 600;">&#129504; Facts</h3>
                            <button onclick="nextFactCard()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; margin-left: 1rem;">&#8594;</button>
                        </div>
                        <button onclick="showAddFactModal()" style="position: absolute; top: 0; right: 0; background: rgba(255,255,255,0.25); border: none; color: white; padding: 0.4rem 0.8rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500;">+ Add</button>
                    </div>
                    
                    <div id="facts-content" style="text-align: center; display: flex; flex-direction: column; justify-content: center; height: 120px;">
                        <div style="font-size: 1rem; font-weight: 600; margin-bottom: 0.8rem;">Memory Palace Technique</div>
                        <div style="font-size: 0.9rem; line-height: 1.3;">The Memory Palace is 2000+ years old. Ancient Greeks used it to remember entire speeches by associating information with familiar locations.</div>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button onclick="reviewFact('struggling')" style="flex: 1; background: rgba(255,87,87,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Struggling</button>
                        <button onclick="reviewFact('getting-it')" style="flex: 1; background: rgba(255,152,0,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Getting It</button>
                        <button onclick="reviewFact('got-it')" style="flex: 1; background: rgba(76,175,80,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Got It</button>
                        <button onclick="reviewFact('mastered')" style="flex: 1; background: rgba(0,200,150,0.9); border: none; color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Mastered</button>
                    </div>
                </div>
            </div>

            <!-- Daily Articulate Speaker Tip -->
            <div style="background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 100%); padding: 1.5rem; border-radius: 16px; margin-bottom: 1rem; box-shadow: 0 8px 32px rgba(168, 85, 247, 0.3); border: 1px solid rgba(168, 85, 247, 0.3);">
                <h3 style="margin: 0 0 1rem 0; color: white; font-size: 1.2rem; font-weight: 600;">&#128483; Daily Articulate Speaker Tip</h3>
                <div id="daily-tip-content" style="color: rgba(255,255,255,0.9); line-height: 1.5;">
                    <div id="tip-category" style="font-weight: 600; margin-bottom: 0.5rem; color: #FFD700;">Loading today's tip...</div>
                    <div id="tip-content">Preparing your daily articulate speaking tip...</div>
                </div>
            </div>
        </div>

        <!-- GRATITUDE SECTION -->
        <div style="margin-bottom: 2rem;">
            <div style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 2rem; border-radius: 16px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);">
                <h2 style="color: white; margin-bottom: 1.5rem; text-align: center; font-size: 1.4rem; font-weight: 600;">&#128591; Daily Gratitude</h2>
                <p style="color: rgba(255,255,255,0.9); text-align: center; margin-bottom: 2rem; font-size: 1rem;">Take a moment to reflect on three things you're grateful for today</p>
                
                <form id="gratitude-form" style="display: flex; flex-direction: column; gap: 1rem;">
                    <div style="position: relative;">
                        <input type="text" id="gratitude-1" placeholder="I'm grateful for..." style="width: 100%; padding: 1rem; border: none; border-radius: 12px; font-size: 1rem; background: rgba(255,255,255,0.95); color: #333; font-weight: 500;" maxlength="100">
                        <span style="position: absolute; top: 0.5rem; right: 1rem; color: rgba(0,0,0,0.4); font-size: 0.8rem;">1</span>
                    </div>
                    
                    <div style="position: relative;">
                        <input type="text" id="gratitude-2" placeholder="I'm also grateful for..." style="width: 100%; padding: 1rem; border: none; border-radius: 12px; font-size: 1rem; background: rgba(255,255,255,0.95); color: #333; font-weight: 500;" maxlength="100">
                        <span style="position: absolute; top: 0.5rem; right: 1rem; color: rgba(0,0,0,0.4); font-size: 0.8rem;">2</span>
                    </div>
                    
                    <div style="position: relative;">
                        <input type="text" id="gratitude-3" placeholder="And I'm grateful for..." style="width: 100%; padding: 1rem; border: none; border-radius: 12px; font-size: 1rem; background: rgba(255,255,255,0.95); color: #333; font-weight: 500;" maxlength="100">
                        <span style="position: absolute; top: 0.5rem; right: 1rem; color: rgba(0,0,0,0.4); font-size: 0.8rem;">3</span>
                    </div>
                    
                    <button type="submit" style="background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.6); color: white; padding: 1rem 2rem; border-radius: 12px; cursor: pointer; font-size: 1.1rem; font-weight: 600; margin-top: 1rem; transition: all 0.3s ease;">
                        &#128154; Save Today's Gratitude
                    </button>
                </form>
                
                <div id="gratitude-feedback" style="text-align: center; margin-top: 1rem; font-weight: 600; color: rgba(255,255,255,0.9); opacity: 0; transition: opacity 0.3s ease;"></div>
            </div>
        </div>

        <!-- DAILY BIBLICAL DEVOTIONAL -->
        <div style="background: linear-gradient(135deg, #84cc16 0%, #65a30d 100%); padding: 2rem; border-radius: 16px; margin-bottom: 2rem; box-shadow: 0 8px 32px rgba(132, 204, 22, 0.3); border: 1px solid rgba(132, 204, 22, 0.3);">
            <h2 style="color: white; margin: 0 0 1.5rem 0; text-align: center; font-size: 1.4rem; font-weight: 600;">‚úùÔ∏è Daily Devotional</h2>
            
            <div style="background: rgba(31, 41, 55, 0.8); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; border: 2px solid #84cc16;">
                <h3 id="devotional-title" style="color: white; margin: 0 0 1rem 0; font-size: 1.2rem; text-align: center;">Loading today's devotional...</h3>
                <div id="devotional-verse-ref" style="color: #84cc16; font-weight: 600; margin-bottom: 1rem; text-align: center; font-size: 1rem;"></div>
                <div id="devotional-verse" style="color: white; font-size: 1.1rem; line-height: 1.6; text-align: center; font-style: italic; margin-bottom: 1.5rem;"></div>
            </div>
            
            <div style="background: rgba(31, 41, 55, 0.8); padding: 1.5rem; border-radius: 12px; border: 2px solid #84cc16;">
                <h4 style="color: #84cc16; margin: 0 0 1rem 0; font-size: 1.1rem;">Today's Message:</h4>
                <div id="devotional-message" style="color: white; font-size: 1rem; line-height: 1.6;">
                    Loading devotional message...
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 1.5rem;">
                <div id="devotional-date" style="color: rgba(255,255,255,0.7); font-size: 0.9rem;"></div>
            </div>
        </div>
    </div>

    <script>
        // Update flip clock
        function updateFlipClock() {
            const now = new Date();
            const pacificTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Los_Angeles"}));

            const hours = pacificTime.getHours();
            const minutes = pacificTime.getMinutes();

            const hour12 = hours === 0 ? 12 : (hours > 12 ? hours - 12 : hours);
            const ampm = hours >= 12 ? 'PM' : 'AM';

            const hourStr = hour12.toString().padStart(2, '0');
            const minStr = minutes.toString().padStart(2, '0');

            updateDigit('hour1', hourStr[0]);
            updateDigit('hour2', hourStr[1]);
            updateDigit('min1', minStr[0]);
            updateDigit('min2', minStr[1]);
            updateDigit('ampm', ampm);
        }

        function updateDigit(id, newValue) {
            const element = document.getElementById(id);
            if (element && element.textContent !== newValue) {
                element.style.transform = 'rotateX(90deg)';
                setTimeout(() => {
                    element.textContent = newValue;
                    element.style.transform = 'rotateX(0deg)';
                }, 300);
            }
        }

        // Update date display
        function updateDate() {
            const now = new Date();
            const pacificTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Los_Angeles"}));
            document.getElementById('current-date').textContent = pacificTime.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Weather API function - Live Kelowna BC data
        async function updateWeather() {
            console.log('Weather updating...');
            try {
                const API_KEY = '51c9ab4ee91dc5978fc9f75b70a4e9bc';
                const KELOWNA_LAT = '49.888';
                const KELOWNA_LON = '-119.496';
                
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${KELOWNA_LAT}&lon=${KELOWNA_LON}&appid=${API_KEY}&units=metric`);
                console.log('API Response Status:', response.status);
                const data = await response.json();
                console.log('Weather data received:', data);
                
                // Temperature (round to nearest degree)
                const temp = Math.round(data.main.temp);
                
                // Weather icon mapping with nighttime detection
                const weatherIcons = {
                    '01d': '&#9728;', '01n': '&#127769;',
                    '02d': '&#9925;', '02n': '&#9729;',  
                    '03d': '&#9729;', '03n': '&#9729;',
                    '04d': '&#9729;', '04n': '&#9729;',
                    '09d': '&#127782;', '09n': '&#127782;',
                    '10d': '&#127783;', '10n': '&#127782;',
                    '11d': '&#9928;', '11n': '&#9928;',
                    '13d': '&#127784;', '13n': '&#127784;',
                    '50d': '&#127787;', '50n': '&#127787;'
                };
                
                const iconCode = data.weather[0].icon;
                const icon = weatherIcons[iconCode] || '&#9925;';
                const condition = data.weather[0].description.charAt(0).toUpperCase() + 
                                data.weather[0].description.slice(1);
                
                // Sunrise/sunset times for Kelowna timezone
                const sunrise = new Date(data.sys.sunrise * 1000).toLocaleTimeString('en-US', {
                    timeZone: 'America/Vancouver',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
                const sunset = new Date(data.sys.sunset * 1000).toLocaleTimeString('en-US', {
                    timeZone: 'America/Vancouver', 
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
                
                // Update weather display - NO raw degree symbol
                console.log(`Weather updated: ${temp}C, ${condition}, ${icon}`);
                document.querySelector('.weather-emoji').innerHTML = icon;
                document.getElementById('weather-temp').innerHTML = `${temp}&deg;C`;
                document.querySelector('.weather-condition').textContent = condition;
                document.getElementById('sunrise-time').textContent = sunrise;
                document.getElementById('sunset-time').textContent = sunset;
                
            } catch (error) {
                console.error('Weather fetch failed:', error);
                // Keep existing display if API fails
            }
        }

        // Google API Functions
        // Auto-refreshing OAuth token system
        const GOOGLE_CREDENTIALS = {
            'client_id': '310221293117-eiv0ouknutm3mjchgio5ceopf9hvbnr8.apps.googleusercontent.com',
            'client_secret': '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',
            'refresh_token': '1//06pZHENOSKxTXCgYIARAAGAYSNwF-L9IraZ1g-rP258FGkJOF1SWOYKmkrDmMeJXKwbzyvjCGPbwGf8KyR0z0CS-su0Mxz90JPpc'
        };

        async function refreshAccessToken() {
            console.log('Refreshing OAuth token...');
            try {
                const response = await fetch('https://oauth2.googleapis.com/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        client_id: GOOGLE_CREDENTIALS.client_id,
                        client_secret: GOOGLE_CREDENTIALS.client_secret,
                        refresh_token: GOOGLE_CREDENTIALS.refresh_token,
                        grant_type: 'refresh_token'
                    })
                });

                if (!response.ok) {
                    throw new Error(`Token refresh failed: ${response.status}`);
                }

                const data = await response.json();
                console.log('Fresh token obtained, expires in:', data.expires_in, 'seconds');
                
                // Store token with expiry time
                const expiryTime = Date.now() + (data.expires_in * 1000) - 60000; // 1 minute buffer
                sessionStorage.setItem('google_access_token', data.access_token);
                sessionStorage.setItem('google_token_expiry', expiryTime.toString());
                
                return data.access_token;
            } catch (error) {
                console.error('Token refresh failed:', error);
                throw error;
            }
        }

        async function getAccessToken() {
            // Check if we have a valid cached token
            const cachedToken = sessionStorage.getItem('google_access_token');
            const tokenExpiry = parseInt(sessionStorage.getItem('google_token_expiry') || '0');
            
            if (cachedToken && Date.now() < tokenExpiry) {
                console.log('Using cached token (valid until', new Date(tokenExpiry).toLocaleTimeString(), ')');
                return cachedToken;
            }
            
            // Need to refresh token
            return await refreshAccessToken();
        }

        async function makeGoogleApiCall(url) {
            try {
                let token = await getAccessToken();
                
                let response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                // If unauthorized, refresh token and retry once
                if (response.status === 401) {
                    console.log('Token expired, refreshing and retrying...');
                    token = await refreshAccessToken();
                    response = await fetch(url, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                }
                
                if (!response.ok) {
                    throw new Error(`API call failed: ${response.status} ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('Google API call failed:', error);
                throw error;
            }
        }

        // Google Calendar Integration
        async function loadCalendarEvents() {
            try {
                console.log('Loading calendar events...');
                
                // Get today's date in Pacific timezone
                const now = new Date();
                console.log(`Current time: ${now.toString()}`);
                
                // Get today's date in Pacific time
                const pacificDateString = now.toLocaleDateString('en-CA', {timeZone: 'America/Vancouver'}); // YYYY-MM-DD format
                console.log(`Today in Pacific time: ${pacificDateString}`);
                
                // Create start/end times for today in Pacific timezone
                const todayStart = new Date(`${pacificDateString}T00:00:00-08:00`); // Start of day PST
                const todayEnd = new Date(`${pacificDateString}T23:59:59-08:00`);   // End of day PST
                
                const timeMin = todayStart.toISOString();
                const timeMax = todayEnd.toISOString();
                
                console.log(`Requesting events for ${pacificDateString} (Pacific Time)`);
                console.log(`API call: ${timeMin} to ${timeMax}`);
                console.log(`In Pacific time: ${todayStart.toLocaleString('en-US', {timeZone: 'America/Vancouver'})} to ${todayEnd.toLocaleString('en-US', {timeZone: 'America/Vancouver'})}`);
                
                // Fetch from both calendars and merge
                const calendars = [
                    'primary', // devondoherty07@gmail.com 
                    'emma.exec.11@gmail.com'
                ];
                
                let allEvents = [];
                
                for (const calendarId of calendars) {
                    try {
                        const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true&orderBy=startTime`;
                        const data = await makeGoogleApiCall(url);
                        allEvents = allEvents.concat(data.items || []);
                        console.log(`Loaded ${data.items?.length || 0} events from ${calendarId}`);
                        
                        // Debug: show first few events with dates
                        if (data.items && data.items.length > 0) {
                            console.log(`Sample events from ${calendarId}:`, 
                                data.items.slice(0, 3).map(event => ({
                                    title: event.summary,
                                    start: event.start?.dateTime || event.start?.date,
                                    date: event.start?.dateTime ? new Date(event.start.dateTime).toLocaleDateString() : event.start?.date
                                }))
                            );
                        }
                    } catch (error) {
                        console.log(`Skipping calendar ${calendarId}:`, error.message);
                    }
                }
                
                const events = allEvents;
                
                // Filter out routine events
                const routineKeywords = [
                    'morning routine', 'power hour', 'wrap up day', 'night routine', 
                    'workout', 'coffee', 'lunch', 'dinner', 'sleep', 'bedtime',
                    'wake up', 'shower', 'commute', 'break', 'meditation', 
                    'stretching', 'emails', 'admin', 'deep work', 'focused work',
                    'reading', 'journaling', 'planning', 'power hour (secondary goals)',
                    'power hour (wyld)'
                ];
                
                const importantEvents = events.filter(event => {
                    const title = (event.summary || '').toLowerCase();
                    return !routineKeywords.some(keyword => title.includes(keyword));
                });
                
                console.log('Calendar stats:', {
                    totalEvents: events.length,
                    importantEvents: importantEvents.length,
                    filtered: importantEvents.slice(0, 5)
                });
                
                displayCalendarEvents(importantEvents.slice(0, 5)); // Show max 5 events
                
            } catch (error) {
                console.error('Calendar loading failed:', error);
                document.getElementById('calendar-events').innerHTML = 
                    `<div style="color: rgba(255,100,100,0.8);">Warning: Calendar error: ${error.message}<br><small>Click header to view online</small></div>`;
            }
        }

        function displayCalendarEvents(events) {
            const container = document.getElementById('calendar-events');
            
            if (events.length === 0) {
                container.innerHTML = '<div style="color: rgba(255,255,255,0.7);">No important events today</div>';
                return;
            }
            
            container.innerHTML = events.map(event => {
                const startTime = event.start.dateTime ? 
                    new Date(event.start.dateTime).toLocaleTimeString('en-US', {
                        timeZone: 'America/Vancouver', 
                        hour: 'numeric', 
                        minute: '2-digit', 
                        hour12: true
                    }) : 'All day';
                
                return `
                    <div class="event-item" style="margin-bottom: 0.8rem;">
                        <div class="event-content">
                            <div style="font-weight: 600;">${event.summary || 'Untitled'}</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">${startTime}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Google Tasks Integration  
        async function loadTasks() {
            try {
                console.log('Loading tasks (forcing fresh data)...');
                
                // Clear any cached tokens to force refresh
                sessionStorage.removeItem('google_access_token');
                sessionStorage.removeItem('google_token_expiry');
                
                // Get task lists with cache-busting
                const timestamp = Date.now();
                const listsData = await makeGoogleApiCall(`https://www.googleapis.com/tasks/v1/users/@me/lists?_=${timestamp}`);
                const taskList = listsData.items?.[0]; // Use first task list
                
                if (!taskList) {
                    throw new Error('No task lists found');
                }
                
                console.log(`Using task list: "${taskList.title}" (ID: ${taskList.id})`);
                
                // Get tasks from the first list with cache-busting
                const tasksData = await makeGoogleApiCall(`https://www.googleapis.com/tasks/v1/lists/${taskList.id}/tasks?_=${timestamp}`);
                console.log(`Raw tasks data:`, tasksData.items);
                
                const tasks = (tasksData.items || []).filter(task => task.status !== 'completed');
                console.log(`Filtered incomplete tasks:`, tasks);
                
                console.log('Tasks stats:', {
                    totalTasks: (tasksData.items || []).length,
                    incompleteTasks: tasks.length,
                    taskList: taskList.title,
                    showingTasks: tasks.slice(0, 5).map(t => ({title: t.title, id: t.id, status: t.status}))
                });
                
                displayTasks(tasks.slice(0, 5), taskList.id); // Show max 5 incomplete tasks
                
            } catch (error) {
                console.error('Tasks loading failed:', error);
                document.getElementById('task-list').innerHTML = 
                    `<div style="color: rgba(255,100,100,0.8);">Warning: Tasks error: ${error.message}<br><small>Click header to view online</small></div>`;
            }
        }

        function displayTasks(tasks, listId) {
            const container = document.getElementById('task-list');
            
            console.log('Displaying tasks:', tasks.map(t => t.title || '(empty title)'));
            
            if (tasks.length === 0) {
                container.innerHTML = '<div style="color: rgba(255,255,255,0.7);">No pending tasks</div>';
                return;
            }
            
            container.innerHTML = tasks.map((task, index) => {
                const title = (task.title || '').trim() || '(Untitled Task)';
                return `
                    <div class="task-item" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem;">
                        <div class="task-content" style="flex-grow: 1;">
                            <div style="font-weight: 600;">${title}</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">
                                ${task.due ? new Date(task.due).toLocaleDateString() : 'No due date'} Updated: ${task.updated ? new Date(task.updated).toLocaleDateString() : 'Unknown'}
                            </div>
                        </div>
                        <div class="task-actions">
                            <input type="checkbox" onclick="completeTask('${task.id}', '${listId}')" 
                                   style="width: 18px; height: 18px; cursor: pointer; accent-color: #4CAF50;">
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function completeTask(taskId, listId) {
            try {
                console.log('Completing task:', taskId);
                const token = await getAccessToken();
                
                const response = await fetch(`https://www.googleapis.com/tasks/v1/lists/${listId}/tasks/${taskId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'completed'
                    })
                });
                
                if (response.ok) {
                    console.log('Task completed successfully');
                    loadTasks(); // Refresh task list
                } else {
                    throw new Error(`Task completion failed: ${response.status}`);
                }
                
            } catch (error) {
                console.error('Task completion failed:', error);
                alert('Failed to complete task. Please try again.');
            }
        }

        function showAddTaskModal() {
            const taskTitle = prompt('Enter new task title:');
            if (taskTitle && taskTitle.trim()) {
                addNewTask(taskTitle.trim());
            }
        }

        async function addNewTask(title) {
            try {
                console.log('Adding new task:', title);
                
                // Get first task list
                const listsData = await makeGoogleApiCall('https://www.googleapis.com/tasks/v1/users/@me/lists');
                const taskList = listsData.items?.[0];
                
                if (!taskList) {
                    throw new Error('No task lists found');
                }
                
                // Add new task
                const token = await getAccessToken();
                const response = await fetch(`https://www.googleapis.com/tasks/v1/lists/${taskList.id}/tasks`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title
                    })
                });
                
                if (response.ok) {
                    console.log('Task added successfully');
                    loadTasks(); // Refresh task list
                } else {
                    throw new Error(`Task addition failed: ${response.status}`);
                }
                
            } catch (error) {
                console.error('Task addition failed:', error);
                alert('Failed to add task. Please try again.');
            }
        }

        // Live Crypto Data Functions
        async function loadLiveCryptoData() {
            try {
                // Bitcoin Price from CoinGecko (WITH TIMEOUT PROTECTION)
                const controller1 = new AbortController();
                const timeout1 = setTimeout(() => controller1.abort(), 10000); // 10 second timeout
                
                const btcResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true', {
                    signal: controller1.signal
                });
                clearTimeout(timeout1);
                
                if (!btcResponse.ok) {
                    throw new Error(`Bitcoin API failed: ${btcResponse.status}`);
                }
                
                const btcData = await btcResponse.json();
                
                if (btcData.bitcoin) {
                    const price = btcData.bitcoin.usd;
                    const change = btcData.bitcoin.usd_24h_change;
                    
                    document.getElementById('btc-price-live').textContent = `$${price.toLocaleString()}`;
                    document.getElementById('btc-change-live').textContent = `${change >= 0 ? '+' : ''}${change.toFixed(1)}%`;
                    document.getElementById('btc-change-live').style.color = change >= 0 ? '#22c55e' : '#ef4444';
                }

                // Fear & Greed Index from Alternative.me (WITH TIMEOUT PROTECTION)
                const controller2 = new AbortController();
                const timeout2 = setTimeout(() => controller2.abort(), 8000); // 8 second timeout
                
                const fearResponse = await fetch('https://api.alternative.me/fng/', {
                    signal: controller2.signal
                });
                clearTimeout(timeout2);
                
                if (!fearResponse.ok) {
                    throw new Error(`Fear/Greed API failed: ${fearResponse.status}`);
                }
                
                const fearData = await fearResponse.json();
                
                if (fearData.data && fearData.data[0]) {
                    const fngValue = parseInt(fearData.data[0].value);
                    const fngText = fearData.data[0].value_classification;
                    
                    document.getElementById('fear-greed-value').textContent = fngValue;
                    document.getElementById('fear-greed-text').textContent = fngText;
                    
                    // Color coding based on Fear & Greed
                    let color = '#ef4444'; // Red for fear
                    if (fngValue >= 50) color = '#f59e0b'; // Amber for neutral
                    if (fngValue >= 75) color = '#22c55e'; // Green for greed
                    
                    document.getElementById('fear-greed-value').style.color = color;
                    document.getElementById('fear-greed-text').style.color = color;
                }

                // 200 EMA Analysis (WITH TIMEOUT PROTECTION)
                const controller3 = new AbortController();
                const timeout3 = setTimeout(() => controller3.abort(), 15000); // 15 second timeout for historical data
                
                const btcHistoryResponse = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=200&interval=daily', {
                    signal: controller3.signal
                });
                clearTimeout(timeout3);
                
                if (!btcHistoryResponse.ok) {
                    throw new Error(`Bitcoin history API failed: ${btcHistoryResponse.status}`);
                }
                
                const btcHistoryData = await btcHistoryResponse.json();
                
                if (btcHistoryData.prices && btcHistoryData.prices.length >= 200) {
                    const prices = btcHistoryData.prices.slice(-200).map(p => p[1]);
                    const ema200 = prices.reduce((a, b) => a + b) / prices.length; // Simplified EMA
                    const currentPrice = prices[prices.length - 1];
                    
                    const isAboveEMA = currentPrice > ema200;
                    
                    document.getElementById('ema-bias').textContent = isAboveEMA ? 'BULLISH' : 'BEARISH';
                    document.getElementById('ema-signal').innerHTML = isAboveEMA ? '&#128200; Longs only' : '&#128201; Shorts only';
                    document.getElementById('ema-bias').style.color = isAboveEMA ? '#22c55e' : '#ef4444';
                    document.getElementById('ema-signal').style.color = isAboveEMA ? '#22c55e' : '#ef4444';
                }

                loadCriticalNews();
                
            } catch (error) {
                console.error('Error loading live crypto data:', error);
                
                // Show error state instead of hanging
                document.getElementById('btc-price-live').textContent = 'API Error';
                document.getElementById('btc-change-live').textContent = 'Retry in 5min';
                document.getElementById('fear-greed-value').textContent = '--';
                document.getElementById('fear-greed-text').textContent = 'API Error';
                document.getElementById('ema-bias').textContent = 'ERROR';
                document.getElementById('ema-signal').textContent = 'Retrying...';
            }
        }

        async function loadCriticalNews() {
            try {
                // WORKING CRYPTO NEWS - Curated Intelligence Categories
                const newsData = {
                    market: [
                        { 
                            title: await getBitcoinPriceAction(), 
                            source: "Market Data", 
                            time: "Live", 
                            url: "https://www.coingecko.com/en/coins/bitcoin"
                        },
                        {
                            title: await getFearGreedUpdate(),
                            source: "Sentiment",
                            time: "Live",
                            url: "https://alternative.me/crypto/fear-and-greed-index/"
                        }
                    ],
                    macro: [
                        {
                            title: "Fed Rate Expectations - Monitor Market Impact",
                            source: "CME FedWatch",
                            time: "Live",
                            url: "https://www.cmegroup.com/markets/interest-rates/cme-fedwatch-tool.html"
                        },
                        {
                            title: "DXY Dollar Strength vs Crypto Markets",
                            source: "TradingView",
                            time: "Live",
                            url: "https://www.tradingview.com/chart/?symbol=TVC:DXY"
                        }
                    ],
                    institutional: [
                        {
                            title: "Bitcoin ETF Flows & Institutional Demand",
                            source: "CoinGlass",
                            time: "Live",
                            url: "https://www.coinglass.com/pro/i/ETF"
                        },
                        {
                            title: "Whale Movement & Large Transaction Analysis",
                            source: "WhaleAlert",
                            time: "Live", 
                            url: "https://whale-alert.io/"
                        }
                    ],
                    altcoins: [
                        {
                            title: await getTopGainerAnalysis(),
                            source: "Market Analysis",
                            time: "Live",
                            url: "https://coinmarketcap.com/gainers-losers/"
                        },
                        {
                            title: "Trending Altcoin Narratives & Sector Rotation",
                            source: "CoinGecko",
                            time: "Live",
                            url: "https://www.coingecko.com/en/crypto-trends"
                        }
                    ]
                };

                // Display categories with live intelligence
                const categories = [
                    { id: 'token-unlocks', icon: '&#9889;', title: 'Market Intelligence', filter: 'market' },
                    { id: 'fed-events', icon: '&#127967;', title: 'Macro Analysis', filter: 'macro' },
                    { id: 'institutional-moves', icon: '&#127970;', title: 'Institutional Intel', filter: 'institutional' },
                    { id: 'emerging-narratives', icon: '&#128302;', title: 'Altcoin Trends', filter: 'altcoins' }
                ];

                for (const cat of categories) {
                    const categoryNews = newsData[cat.filter] || [];
                    
                    if (categoryNews.length === 0) {
                        document.getElementById(cat.id).innerHTML = `
                            <div style="font-size: 0.85rem; color: #ef4444; opacity: 0.8;">
                                üìä Loading intelligence...
                            </div>
                        `;
                    } else {
                        const html = categoryNews.map(news => 
                            `<div style="margin-bottom: 0.5rem; font-size: 0.85rem; opacity: 0.9; cursor: pointer;" onclick="window.open('${news.url}', '_blank')">
                                &#8226; <span style="color: #10b981;">${news.source}</span>: ${news.title}
                                <div style="font-size: 0.75rem; opacity: 0.6; margin-left: 10px; color: #fbbf24;">${news.time}</div>
                            </div>`
                        ).join('');
                        
                        document.getElementById(cat.id).innerHTML = html;
                    }
                }

            } catch (error) {
                console.error('Error loading critical intelligence:', error);
                
                // Show loading states instead of permanent errors
                const errorCategories = ['token-unlocks', 'fed-events', 'institutional-moves', 'emerging-narratives'];
                errorCategories.forEach(id => {
                    document.getElementById(id).innerHTML = `
                        <div style="font-size: 0.85rem; color: #f59e0b; opacity: 0.8;">
                            üîÑ Refreshing intelligence...
                        </div>
                    `;
                });
            }
        }

        // Generate live market intelligence
        async function getBitcoinPriceAction() {
            try {
                const btcResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
                const btcData = await btcResponse.json();
                
                if (btcData.bitcoin) {
                    const price = btcData.bitcoin.usd;
                    const change = btcData.bitcoin.usd_24h_change;
                    const direction = change > 0 ? "Breaking Higher" : "Under Pressure";
                    
                    return `Bitcoin ${direction} - $${price.toLocaleString()} (${change > 0 ? '+' : ''}${change.toFixed(1)}%)`;
                }
            } catch (error) {
                console.log('Bitcoin price fetch failed:', error);
            }
            
            return "Bitcoin Price Action - Live Market Analysis";
        }

        async function getFearGreedUpdate() {
            try {
                const fearResponse = await fetch('https://api.alternative.me/fng/');
                const fearData = await fearResponse.json();
                
                if (fearData.data && fearData.data[0]) {
                    const fngValue = parseInt(fearData.data[0].value);
                    const fngText = fearData.data[0].value_classification;
                    
                    return `Market Sentiment: ${fngText} (${fngValue}/100) - Risk ${fngValue > 50 ? 'On' : 'Off'}`;
                }
            } catch (error) {
                console.log('Fear/Greed fetch failed:', error);
            }
            
            return "Crypto Market Sentiment Analysis - Fear & Greed Index";
        }

        async function getTopGainerAnalysis() {
            try {
                const gainersResponse = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=percent_change_24h_desc&per_page=5&page=1&sparkline=false');
                const gainersData = await gainersResponse.json();
                
                if (gainersData && gainersData.length > 0) {
                    const topGainer = gainersData[0];
                    const change = topGainer.price_change_percentage_24h;
                    
                    return `Top Mover: ${topGainer.symbol.toUpperCase()} +${change.toFixed(1)}% - Momentum Analysis`;
                }
            } catch (error) {
                console.log('Top gainers fetch failed:', error);
            }
            
            return "Altcoin Market Leaders - Performance Analysis";
        }

        function getCryptoCategory(title) {
            const titleLower = title.toLowerCase();
            if (titleLower.includes('bitcoin') || titleLower.includes('btc') || titleLower.includes('price') || titleLower.includes('market')) {
                return 'market';
            } else if (titleLower.includes('fed') || titleLower.includes('federal') || titleLower.includes('policy') || titleLower.includes('rate')) {
                return 'macro';
            } else if (titleLower.includes('blackrock') || titleLower.includes('institutional') || titleLower.includes('etf') || titleLower.includes('grayscale')) {
                return 'institutional';
            } else {
                return 'altcoins';
            }
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return 'This week';
        }

        function showMacroCharts() {
            const macroCharts = [
                {
                    name: "üìà US Dollar Index (DXY)",
                    url: "https://www.tradingview.com/chart/?symbol=TVC%3ADXY",
                    description: "Dollar strength/weakness vs Bitcoin"
                },
                {
                    name: "üí∞ Money Supply (M2)",
                    url: "https://fred.stlouisfed.org/series/M2SL",
                    description: "Money printing trends"
                },
                {
                    name: "üéØ Fed Rate Cut Probability",
                    url: "https://www.cmegroup.com/markets/interest-rates/cme-fedwatch-tool.html",
                    description: "Live rate cut expectations"
                },
                {
                    name: "üìä 7-10 Year Treasury",
                    url: "https://www.tradingview.com/chart/?symbol=AMEX%3AIEF",
                    description: "iShares 7-10 Year Treasury Bond ETF"
                },
                {
                    name: "üè¢ High Yield Corporate Bonds",
                    url: "https://www.tradingview.com/chart/?symbol=AMEX%3AHYG",
                    description: "iShares iBoxx High Yield Corporate Bond ETF"
                },
                {
                    name: "‚Çø Bitcoin vs Bonds Correlation",
                    url: "https://www.tradingview.com/chart/?symbol=BTCUSD%2FTVC%3ATNX",
                    description: "BTC vs 10-Year Treasury correlation"
                }
            ];

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 1000; display: flex; 
                justify-content: center; align-items: center; padding: 2rem;
            `;
            
            let chartsHTML = `
                <div style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 2rem; border-radius: 16px; max-width: 600px; max-height: 80vh; overflow-y: auto; color: white;" onclick="event.stopPropagation()">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="margin: 0; color: #10b981;">üìä Live Macro Dashboard</h2>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: rgba(239, 68, 68, 0.8); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">‚úï Close</button>
                    </div>
                    <div style="display: grid; gap: 1rem;">
            `;
            
            macroCharts.forEach(chart => {
                chartsHTML += `
                    <a href="${chart.url}" target="_blank" style="
                        background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 12px; 
                        text-decoration: none; color: white; display: block;
                        transition: all 0.3s ease; border: 2px solid transparent;
                    " onmouseover="this.style.background='rgba(16, 185, 129, 0.2)'; this.style.borderColor='#10b981'" onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.borderColor='transparent'">
                        <div style="font-weight: 600; font-size: 1.1rem; margin-bottom: 0.5rem;">${chart.name}</div>
                        <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">${chart.description}</div>
                    </a>
                `;
            });
            
            chartsHTML += `
                    </div>
                    <div style="text-align: center; margin-top: 2rem; font-size: 0.9rem; color: rgba(255,255,255,0.6);">
                        Click any chart to analyze macro environment for Bitcoin correlation
                    </div>
                </div>
            `;
            
            modal.innerHTML = chartsHTML;
            modal.onclick = () => modal.remove();
            document.body.appendChild(modal);
        }

        // DAILY ARTICULATE SPEAKER TIP - Changes Daily
        function loadDailySpeakerTip() {
            const speakerTips = [
                {
                    category: "Voice Projection Tip:",
                    content: "Speak from your diaphragm, not your throat. Place one hand on your chest, one on your stomach - only the lower hand should move when you breathe to speak."
                },
                {
                    category: "Clarity Tip:",
                    content: "Practice the 'Triple T' technique: Take time to think, then talk. Pause between thoughts to give your audience time to process."
                },
                {
                    category: "Confidence Tip:",
                    content: "Plant your feet shoulder-width apart and keep your weight centered. This 'power stance' naturally makes your voice sound more confident and authoritative."
                },
                {
                    category: "Engagement Tip:",
                    content: "Use the 3-second rule: Make eye contact with each person for 3 full seconds before moving to the next. This creates genuine connection."
                },
                {
                    category: "Pacing Tip:",
                    content: "Vary your speaking speed like a musical rhythm. Slow down for important points, speed up for energy, pause for emphasis."
                },
                {
                    category: "Gesture Tip:",
                    content: "Keep your hands visible and use purposeful gestures that match your words. Hidden hands subconsciously signal distrust to your audience."
                },
                {
                    category: "Memory Tip:",
                    content: "Use the Memory Palace technique: Associate each point with a specific room in your house. Walk through mentally to recall your entire speech."
                },
                {
                    category: "Anxiety Tip:",
                    content: "Practice 4-7-8 breathing before speaking: Inhale for 4 counts, hold for 7, exhale for 8. This activates your parasympathetic nervous system."
                },
                {
                    category: "Authority Tip:",
                    content: "Lower your voice pitch slightly at the end of statements. Rising inflection (uptalk) makes statements sound like questions and reduces perceived authority."
                },
                {
                    category: "Storytelling Tip:",
                    content: "Use the SOAR structure: Situation, Obstacle, Action, Result. Every compelling story needs these four elements to keep audience engaged."
                }
            ];

            // Use date to cycle through tips (changes daily)
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            const tipIndex = dayOfYear % speakerTips.length;
            
            const todaysTip = speakerTips[tipIndex];
            
            document.getElementById('tip-category').textContent = todaysTip.category;
            document.getElementById('tip-content').textContent = todaysTip.content;
        }

        // LIVE DAILY DEVOTIONAL SYSTEM - Multiple Free APIs

        async function loadDailyDevotional() {
            try {
                const today = new Date();
                document.getElementById('devotional-date').textContent = today.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });

                // Try multiple free devotional APIs
                let devotionalLoaded = false;

                // API 1: Try Verse of the Day from bible-api.com
                if (!devotionalLoaded) {
                    try {
                        // Get verse of the day based on current date
                        const verses = [
                            'Jeremiah 29:11', 'Philippians 4:13', 'Romans 8:28', 'Proverbs 3:5-6',
                            'Isaiah 40:31', '1 Corinthians 10:13', 'Matthew 11:28', 'Psalm 23:1',
                            'John 3:16', 'Ephesians 2:8-9', 'Hebrews 11:1', 'James 1:17',
                            'Psalm 46:1', '2 Corinthians 5:7', 'Romans 12:2', 'Galatians 2:20'
                        ];
                        
                        const todayVerse = verses[Math.floor(today.getDate() % verses.length)];
                        const response = await fetch(`https://bible-api.com/${encodeURIComponent(todayVerse)}`);
                        
                        if (response.ok) {
                            const data = await response.json();
                            document.getElementById('devotional-title').textContent = 'Daily Word from God';
                            document.getElementById('devotional-verse-ref').textContent = data.reference;
                            document.getElementById('devotional-verse').textContent = `"${data.text.trim()}"`;
                            document.getElementById('devotional-message').textContent = generateDevotionalMessage(data.reference, data.text);
                            devotionalLoaded = true;
                        }
                    } catch (e) {
                        console.log('Bible API failed, trying backup...');
                    }
                }

                // API 2: Try Daily Verse API (backup)
                if (!devotionalLoaded) {
                    try {
                        const response = await fetch('https://beta.ourmanna.com/api/v1/get/?format=json');
                        if (response.ok) {
                            const data = await response.json();
                            document.getElementById('devotional-title').textContent = 'Daily Bread';
                            document.getElementById('devotional-verse-ref').textContent = data.verse.details.reference;
                            document.getElementById('devotional-verse').textContent = `"${data.verse.details.text}"`;
                            document.getElementById('devotional-message').textContent = generateDevotionalMessage(data.verse.details.reference, data.verse.details.text);
                            devotionalLoaded = true;
                        }
                    } catch (e) {
                        console.log('OurManna API failed, using final backup...');
                    }
                }

                // Final fallback: Random inspirational content with live Bible verse
                if (!devotionalLoaded) {
                    const fallbackVerses = [
                        { ref: 'Isaiah 41:10', text: 'Fear not, for I am with you; be not dismayed, for I am your God; I will strengthen you, I will help you, I will uphold you with my righteous right hand.' },
                        { ref: 'Psalm 27:1', text: 'The LORD is my light and my salvation; whom shall I fear? The LORD is the stronghold of my life‚Äîof whom shall I be afraid?' },
                        { ref: '1 Peter 5:7', text: 'Cast all your anxiety on him because he cares for you.' }
                    ];
                    
                    const randomVerse = fallbackVerses[Math.floor(today.getDate() % fallbackVerses.length)];
                    document.getElementById('devotional-title').textContent = 'God\'s Promise for Today';
                    document.getElementById('devotional-verse-ref').textContent = randomVerse.ref;
                    document.getElementById('devotional-verse').textContent = `"${randomVerse.text}"`;
                    document.getElementById('devotional-message').textContent = generateDevotionalMessage(randomVerse.ref, randomVerse.text);
                }

            } catch (error) {
                console.error('All devotional APIs failed:', error);
                // Emergency fallback
                document.getElementById('devotional-title').textContent = 'God\'s Faithfulness';
                document.getElementById('devotional-verse-ref').textContent = 'Lamentations 3:22-23';
                document.getElementById('devotional-verse').textContent = '"Because of the LORD\'s great love we are not consumed, for his compassions never fail. They are new every morning; great is your faithfulness."';
                document.getElementById('devotional-message').textContent = 'No matter what challenges you face today, remember that God\'s mercy and faithfulness are renewed every morning. Trust in His provision and guidance as you make important decisions.';
            }
        }

        function generateDevotionalMessage(verseRef, verseText) {
            const messages = [
                `Today's verse reminds us that God is always with us in our decisions and endeavors. As you analyze markets and make financial choices, remember that our ultimate security comes from the Lord.`,
                `In times of uncertainty and market volatility, this scripture anchors our hearts in God's unchanging character. Let His Word guide your wisdom today.`,
                `God's promises are as reliable as the sunrise. Just as you research investments carefully, spend time in God's Word to make spiritually sound decisions.`,
                `This verse speaks to the importance of trusting God with our plans and resources. Pray for wisdom as you steward what He has entrusted to you.`,
                `Today's scripture offers hope and direction for believers navigating complex decisions. Let God's truth illuminate your path forward.`
            ];
            
            const today = new Date();
            return messages[Math.floor(today.getDate() % messages.length)];
        }

        // MOONSHOT SOCIAL SENTIMENT ANALYSIS - Growing Discussion & Narrative Trends
        async function loadMoonshotData() {
            try {
                document.getElementById('social-status').textContent = 'Scanning 1000+ Coins...';
                document.getElementById('social-status').style.background = 'rgba(245, 158, 11, 0.8)';

                // MASSIVE 1000+ coin scan for social sentiment patterns (WITH TIMEOUT PROTECTION)
                const allCoins = [];
                const maxPages = 5; // Reduced from 10 to prevent hanging
                
                for (let page = 1; page <= maxPages; page++) {
                    try {
                        // Add timeout to prevent hanging
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 8000); // 8 second timeout
                        
                        const coinsResponse = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc&per_page=100&page=${page}&sparkline=false&price_change_percentage=1h%2C24h%2C7d`, {
                            signal: controller.signal
                        });
                        
                        clearTimeout(timeoutId);
                        
                        if (!coinsResponse.ok) {
                            console.log(`Page ${page} failed with status: ${coinsResponse.status}`);
                            break;
                        }
                        
                        const pageData = await coinsResponse.json();
                        if (pageData && Array.isArray(pageData) && pageData.length > 0) {
                            allCoins.push(...pageData);
                        } else {
                            console.log(`Page ${page} returned no data`);
                            break;
                        }
                        
                        // Longer delay for API rate limits
                        if (page < maxPages) await new Promise(resolve => setTimeout(resolve, 300));
                        
                    } catch (pageError) {
                        if (pageError.name === 'AbortError') {
                            console.log(`Page ${page} timed out after 8 seconds`);
                        } else {
                            console.log(`Failed to load page ${page}:`, pageError);
                        }
                        break;
                    }
                }

                // SOCIAL SENTIMENT INTELLIGENCE - Find growing discussion patterns
                const socialTrendingCoins = [];
                
                for (const coin of allCoins) {
                    const priceChange1h = coin.price_change_percentage_1h || 0;
                    const priceChange24h = coin.price_change_percentage_24h || 0;
                    const priceChange7d = coin.price_change_percentage_7d || 0;
                    const volume = coin.total_volume || 0;
                    const marketCap = coin.market_cap || 0;
                    const rank = coin.market_cap_rank || 9999;
                    
                    // Skip stablecoins and major established coins
                    const symbol = coin.symbol.toUpperCase();
                    if (['BTC', 'ETH', 'USDT', 'USDC', 'BUSD', 'DAI', 'TUSD', 'BNB'].includes(symbol)) continue;
                    
                    // SOCIAL MOMENTUM SCORING - Multiple sentiment indicators
                    let socialScore = 0;
                    let reasons = [];
                    
                    // Indicator 1: Unusual Volume Patterns (community interest building)
                    const volumeToMcap = volume / marketCap;
                    if (volumeToMcap > 0.15 && marketCap < 1000000000) { // High volume on smaller caps
                        socialScore += 4;
                        reasons.push('üî• Community Volume Surge');
                    }
                    
                    // Indicator 2: Acceleration Pattern (gaining momentum fast)
                    if (priceChange1h > 2 && priceChange1h > (priceChange24h / 12)) {
                        socialScore += 3;
                        reasons.push('‚ö° Accelerating Fast');
                    }
                    
                    // Indicator 3: Narrative/Trending Name Detection (meme/trend potential)
                    const coinName = coin.name.toLowerCase();
                    const coinSymbol = symbol.toLowerCase();
                    if (coinName.includes('trump') || coinName.includes('maga') || coinName.includes('biden') ||
                        coinName.includes('doge') || coinName.includes('shib') || coinName.includes('pepe') ||
                        coinName.includes('ai') || coinName.includes('inu') || coinName.includes('moon') ||
                        coinName.includes('elon') || coinName.includes('floki') || coinSymbol.includes('safe') ||
                        coinSymbol.includes('baby') || coinName.includes('wojak')) {
                        socialScore += 5;
                        reasons.push('üé≠ Trending Narrative');
                    }
                    
                    // Indicator 4: Small Cap with Growing Interest (room for explosive growth)
                    if (marketCap > 5000000 && marketCap < 500000000 && volume > 1000000) {
                        socialScore += 3;
                        reasons.push('üíé Small Cap Interest');
                    }
                    
                    // Indicator 5: Rank Movement Potential (coins climbing ranks)
                    if (priceChange7d > priceChange24h * 2 && rank > 200 && rank < 2000) {
                        socialScore += 2;
                        reasons.push('üìà Weekly Momentum');
                    }
                    
                    // Indicator 6: Volume Spike vs Market Cap (insider activity)
                    if (volume > marketCap * 0.3 && marketCap < 2000000000) {
                        socialScore += 3;
                        reasons.push('üëÅÔ∏è Unusual Activity');
                    }
                    
                    // Only include coins with strong social indicators
                    if (socialScore >= 6 && volume > 500000 && marketCap > 1000000) {
                        socialTrendingCoins.push({
                            ...coin,
                            socialScore,
                            reasons: reasons.slice(0, 3), // Top 3 reasons
                            whyPicked: `Social Score: ${socialScore}/20 - ${reasons.join(' ‚Ä¢ ')}`
                        });
                    }
                }
                
                // Sort by social intelligence score (highest first)
                socialTrendingCoins.sort((a, b) => b.socialScore - a.socialScore);
                const topSocialCoins = socialTrendingCoins.slice(0, 5);

                let html = '';
                
                if (topSocialCoins.length === 0) {
                    html = `
                        <div style="text-align: center; padding: 2rem; opacity: 0.7;">
                            <div style="font-size: 1rem; margin-bottom: 0.5rem;">üîç No Strong Social Trends</div>
                            <div style="font-size: 0.8rem;">Scanned ${allCoins.length} coins for growing discussion patterns</div>
                            <div style="font-size: 0.8rem; margin-top: 0.5rem; color: rgba(255,255,255,0.6);">Waiting for narrative shifts and community buzz to emerge</div>
                        </div>
                    `;
                } else {
                    // Show only first 4 initially, with expand option
                    const maxInitialShow = 4;
                    const showingAll = document.getElementById('moonshot-show-all')?.dataset.showing === 'true';
                    const coinsToShow = showingAll ? topSocialCoins : topSocialCoins.slice(0, maxInitialShow);
                    
                    coinsToShow.forEach((coin, index) => {
                        const change24h = coin.price_change_percentage_24h;
                        const volume = coin.total_volume;
                        const marketCap = coin.market_cap;
                        
                        // Social sentiment classification
                        let sentiment = "üìä Building";
                        let riskLevel = "High";
                        let color = "#6b7280";
                        
                        if (coin.socialScore >= 12) {
                            sentiment = "üî• Viral Potential";
                            riskLevel = "Extreme";
                            color = "#ef4444";
                        } else if (coin.socialScore >= 9) {
                            sentiment = "‚ö° Strong Buzz";
                            riskLevel = "Very High";
                            color = "#10b981";
                        } else if (coin.socialScore >= 6) {
                            sentiment = "üëÄ Growing Interest";
                            riskLevel = "High";
                            color = "#f59e0b";
                        }

                        const formatVolume = (vol) => {
                            if (vol > 1e9) return `$${(vol/1e9).toFixed(1)}B`;
                            if (vol > 1e6) return `$${(vol/1e6).toFixed(0)}M`;
                            return `$${(vol/1e3).toFixed(0)}K`;
                        };

                        const formatMarketCap = (cap) => {
                            if (cap > 1e9) return `$${(cap/1e9).toFixed(2)}B`;
                            if (cap > 1e6) return `$${(cap/1e6).toFixed(0)}M`;
                            return `$${(cap/1e3).toFixed(0)}K`;
                        };

                        html += `
                            <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; margin-bottom: 0.8rem; cursor: pointer; transition: all 0.3s ease; border-left: 4px solid ${color};" onclick="window.open('https://www.coingecko.com/en/coins/${coin.id}', '_blank')">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 1rem; color: white;">${coin.symbol.toUpperCase()} <span style="font-size: 0.8rem; opacity: 0.7;">${coin.name}</span></div>
                                        <div style="font-size: 0.8rem; opacity: 0.8; color: white; margin-bottom: 0.3rem;">${sentiment} ‚Ä¢ Score: ${coin.socialScore} ‚Ä¢ Risk: ${riskLevel}</div>
                                        <div style="font-size: 0.75rem; opacity: 0.7; color: #fbbf24; line-height: 1.2; font-weight: 500;">WHY PICKED: ${coin.reasons.join(' ‚Ä¢ ')}</div>
                                        <div style="font-size: 0.8rem; opacity: 0.7; color: white; margin-top: 0.3rem;">Vol: ${formatVolume(volume)} ‚Ä¢ MCap: ${formatMarketCap(marketCap)} ‚Ä¢ Rank #${coin.market_cap_rank}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="background: ${change24h > 0 ? '#10b981' : '#ef4444'}; color: white; padding: 0.3rem 0.8rem; border-radius: 6px; font-size: 0.9rem; font-weight: 600;">${change24h > 0 ? '+' : ''}${change24h.toFixed(1)}%</div>
                                        <div style="font-size: 0.7rem; opacity: 0.7; margin-top: 0.2rem; color: white;">Social Trend</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }

                document.getElementById('moonshot-loading').style.display = 'none';
                // Add show more/less button if there are more than 4 results
                if (topSocialCoins.length > 4) {
                    const showingAll = document.getElementById('moonshot-show-all')?.dataset.showing === 'true';
                    const buttonText = showingAll ? `‚ñ≤ Show Less (4 of ${topSocialCoins.length})` : `‚ñº Show All ${topSocialCoins.length} Social Signals`;
                    
                    html += `
                        <div id="moonshot-show-all" data-showing="${showingAll || false}" 
                             style="text-align: center; margin-top: 1rem; cursor: pointer; padding: 0.8rem; background: rgba(168, 85, 247, 0.2); border-radius: 8px; border: 1px solid rgba(168, 85, 247, 0.3); transition: all 0.3s ease;"
                             onclick="toggleMoonshotDisplay()"
                             onmouseover="this.style.background='rgba(168, 85, 247, 0.3)'"
                             onmouseout="this.style.background='rgba(168, 85, 247, 0.2)'">
                            <span style="color: #c084fc; font-weight: 600; font-size: 0.9rem;">${buttonText}</span>
                        </div>
                    `;
                }

                document.getElementById('moonshot-content').innerHTML = html;
                document.getElementById('moonshot-content').style.display = 'block';
                document.getElementById('social-status').textContent = `${topSocialCoins.length}/${allCoins.length} Social Signals`;
                document.getElementById('social-status').style.background = 'rgba(34, 197, 94, 0.8)';

            } catch (error) {
                console.error('Error loading moonshot data:', error);
                document.getElementById('moonshot-loading').innerHTML = `
                    <div style="text-align: center; padding: 2rem; opacity: 0.7; color: #ef4444;">
                        <div style="font-size: 1rem; margin-bottom: 0.5rem;">‚ö†Ô∏è ${error.name === 'AbortError' ? 'Request Timeout' : 'API Error'}</div>
                        <div style="font-size: 0.8rem;">Will retry in 15 minutes...</div>
                    </div>
                `;
                document.getElementById('social-status').textContent = error.name === 'AbortError' ? 'Timeout' : 'Error';
                document.getElementById('social-status').style.background = 'rgba(239, 68, 68, 0.8)';
            }
        }

        // SWING TRADING - Devon's Bitcoin Outperformance Strategy (500+ Coins)
        async function loadSwingTradingData() {
            try {
                document.getElementById('swing-status').textContent = 'Scanning 500+ Coins...';
                document.getElementById('swing-status').style.background = 'rgba(245, 158, 11, 0.8)';

                // Get current Bitcoin price and 24h change for outperformance calculations
                const btcController = new AbortController();
                const btcTimeout = setTimeout(() => btcController.abort(), 8000);
                
                const btcResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true', {
                    signal: btcController.signal
                });
                clearTimeout(btcTimeout);
                
                if (!btcResponse.ok) throw new Error('Bitcoin price API failed');
                const btcData = await btcResponse.json();
                const btcChange24h = btcData.bitcoin.usd_24h_change || 0;

                // MASSIVE 500+ coin scan for Bitcoin outperformance patterns
                const allCoins = [];
                const maxPages = 5; // 5 pages √ó 100 coins = 500+ coins
                
                for (let page = 1; page <= maxPages; page++) {
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 8000);
                        
                        const coinsResponse = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc&per_page=100&page=${page}&sparkline=false&price_change_percentage=1h%2C24h%2C7d`, {
                            signal: controller.signal
                        });
                        
                        clearTimeout(timeoutId);
                        
                        if (!coinsResponse.ok) {
                            console.log(`Swing trading page ${page} failed: ${coinsResponse.status}`);
                            break;
                        }
                        
                        const pageData = await coinsResponse.json();
                        if (pageData && Array.isArray(pageData) && pageData.length > 0) {
                            allCoins.push(...pageData);
                        } else {
                            break;
                        }
                        
                        if (page < maxPages) await new Promise(resolve => setTimeout(resolve, 300));
                        
                    } catch (pageError) {
                        if (pageError.name === 'AbortError') {
                            console.log(`Swing page ${page} timed out`);
                        } else {
                            console.log(`Failed to load swing page ${page}:`, pageError);
                        }
                        break;
                    }
                }

                // DEVON'S SWING TRADING ALGORITHM - Bitcoin Outperformance Analysis
                const swingOpportunities = [];
                
                for (const coin of allCoins) {
                    const priceChange24h = coin.price_change_percentage_24h || 0;
                    const priceChange1h = coin.price_change_percentage_1h || 0;
                    const volume = coin.total_volume || 0;
                    const marketCap = coin.market_cap || 0;
                    const rank = coin.market_cap_rank || 9999;
                    
                    // Skip stablecoins and Bitcoin itself
                    const symbol = coin.symbol.toUpperCase();
                    if (['BTC', 'USDT', 'USDC', 'BUSD', 'DAI', 'TUSD'].includes(symbol)) continue;
                    
                    // Calculate Bitcoin outperformance
                    const outperformance = priceChange24h - btcChange24h;
                    
                    // DEVON'S EXACT CRITERIA - Bitcoin Outperformance + Volume + Momentum
                    let swingScore = 0;
                    let signals = [];
                    
                    // Primary: Bitcoin Outperformance (most important for Devon)
                    if (outperformance > 5) {
                        swingScore += 4;
                        signals.push(`+${outperformance.toFixed(1)}% vs BTC`);
                    } else if (outperformance > 2) {
                        swingScore += 2;
                        signals.push(`+${outperformance.toFixed(1)}% vs BTC`);
                    }
                    
                    // 35 EMA Pullback Signal (1h momentum vs 24h - indicates pullback/entry)
                    if (priceChange1h > 0 && priceChange1h < (priceChange24h / 8)) {
                        swingScore += 2;
                        signals.push('35 EMA Pullback Setup');
                    }
                    
                    // Volume Confirmation
                    const volumeToMcap = volume / marketCap;
                    if (volumeToMcap > 0.1) {
                        swingScore += 2;
                        signals.push('High Volume');
                    }
                    
                    // Market Cap Filter (avoid micro caps for swing trading)
                    if (marketCap > 100000000 && marketCap < 10000000000) { // $100M - $10B
                        swingScore += 1;
                        signals.push('Swing-Size Cap');
                    }
                    
                    // Trend Continuation (7d vs 24h strength)
                    const priceChange7d = coin.price_change_percentage_7d || 0;
                    if (priceChange7d > priceChange24h && priceChange7d > 10) {
                        swingScore += 2;
                        signals.push('Weekly Trend Strong');
                    }
                    
                    // Only include coins with strong swing signals (outperforming Bitcoin + other factors)
                    if (swingScore >= 4 && outperformance > 1 && volume > 5000000) { // Minimum $5M volume
                        swingOpportunities.push({
                            ...coin,
                            swingScore,
                            outperformance,
                            signals: signals.slice(0, 3), // Top 3 signals
                            btcOutperformance: outperformance
                        });
                    }
                }
                
                // Sort by swing score (best setups first)
                swingOpportunities.sort((a, b) => b.swingScore - a.swingScore);
                const topSwingTrades = swingOpportunities.slice(0, 8); // Top 8 swing opportunities

                let html = '';
                
                if (topSwingTrades.length === 0) {
                    html = `
                        <div style="text-align: center; padding: 2rem; opacity: 0.7;">
                            <div style="font-size: 1rem; margin-bottom: 0.5rem;">üîç No Strong Bitcoin Outperformers</div>
                            <div style="font-size: 0.8rem;">Scanned ${allCoins.length} coins - waiting for clear swing setups</div>
                            <div style="font-size: 0.8rem; margin-top: 0.5rem; color: rgba(255,255,255,0.6);">BTC: ${btcChange24h > 0 ? '+' : ''}${btcChange24h.toFixed(1)}% - Looking for outperformers</div>
                        </div>
                    `;
                } else {
                    // Show only first 4 initially, with expand option
                    const maxInitialShow = 4;
                    const showingAll = document.getElementById('swing-show-all')?.dataset.showing === 'true';
                    const coinsToShow = showingAll ? topSwingTrades : topSwingTrades.slice(0, maxInitialShow);
                    
                    coinsToShow.forEach((coin, index) => {
                        const change24h = coin.price_change_percentage_24h;
                        const volume = coin.total_volume;
                        const marketCap = coin.market_cap;
                        
                        // Swing setup classification
                        let setup = "üìä Setup";
                        let confidence = "Monitor";
                        let color = "#6b7280";
                        
                        if (coin.swingScore >= 8) {
                            setup = "üöÄ Strong Setup";
                            confidence = "High";
                            color = "#10b981";
                        } else if (coin.swingScore >= 6) {
                            setup = "‚ö° Good Setup";
                            confidence = "Good";
                            color = "#f59e0b";
                        } else if (coin.swingScore >= 4) {
                            setup = "üìà Emerging Setup";
                            confidence = "Watch";
                            color = "#3b82f6";
                        }

                        const formatVolume = (vol) => {
                            if (vol > 1e9) return `$${(vol/1e9).toFixed(1)}B`;
                            if (vol > 1e6) return `$${(vol/1e6).toFixed(0)}M`;
                            return `$${(vol/1e3).toFixed(0)}K`;
                        };

                        const formatMarketCap = (cap) => {
                            if (cap > 1e9) return `$${(cap/1e9).toFixed(2)}B`;
                            if (cap > 1e6) return `$${(cap/1e6).toFixed(0)}M`;
                            return `$${(cap/1e3).toFixed(0)}K`;
                        };

                        html += `
                            <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; margin-bottom: 0.8rem; cursor: pointer; transition: all 0.3s ease; border-left: 4px solid ${color};" onclick="window.open('https://www.tradingview.com/chart/?symbol=${coin.symbol.toUpperCase()}USDT', '_blank')">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 1rem; color: white;">${coin.symbol.toUpperCase()} <span style="font-size: 0.8rem; opacity: 0.7;">${coin.name}</span></div>
                                        <div style="font-size: 0.8rem; opacity: 0.8; color: white; margin-bottom: 0.3rem;">${setup} ‚Ä¢ Score: ${coin.swingScore} ‚Ä¢ ${confidence}</div>
                                        <div style="font-size: 0.75rem; opacity: 0.7; color: #3b82f6; line-height: 1.2; font-weight: 500;">SIGNALS: ${coin.signals.join(' ‚Ä¢ ')}</div>
                                        <div style="font-size: 0.8rem; opacity: 0.7; color: white; margin-top: 0.3rem;">Vol: ${formatVolume(volume)} ‚Ä¢ MCap: ${formatMarketCap(marketCap)} ‚Ä¢ Rank #${coin.market_cap_rank}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="background: ${change24h > 0 ? '#10b981' : '#ef4444'}; color: white; padding: 0.3rem 0.8rem; border-radius: 6px; font-size: 0.9rem; font-weight: 600;">${change24h > 0 ? '+' : ''}${change24h.toFixed(1)}%</div>
                                        <div style="font-size: 0.7rem; opacity: 0.7; margin-top: 0.2rem; color: white;">vs BTC: +${coin.outperformance.toFixed(1)}%</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }

                // Add show more/less button if there are more than 4 results
                if (topSwingTrades.length > 4) {
                    const showingAll = document.getElementById('swing-show-all')?.dataset.showing === 'true';
                    const buttonText = showingAll ? `‚ñ≤ Show Less (4 of ${topSwingTrades.length})` : `‚ñº Show All ${topSwingTrades.length} Opportunities`;
                    
                    html += `
                        <div id="swing-show-all" data-showing="${showingAll || false}" 
                             style="text-align: center; margin-top: 1rem; cursor: pointer; padding: 0.8rem; background: rgba(59, 130, 246, 0.2); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); transition: all 0.3s ease;"
                             onclick="toggleSwingDisplay()"
                             onmouseover="this.style.background='rgba(59, 130, 246, 0.3)'"
                             onmouseout="this.style.background='rgba(59, 130, 246, 0.2)'">
                            <span style="color: #60a5fa; font-weight: 600; font-size: 0.9rem;">${buttonText}</span>
                        </div>
                    `;
                }

                document.getElementById('swing-loading').style.display = 'none';
                document.getElementById('swing-content').innerHTML = html;
                document.getElementById('swing-content').style.display = 'block';
                document.getElementById('swing-status').textContent = `${topSwingTrades.length}/${allCoins.length} Opportunities`;
                document.getElementById('swing-status').style.background = 'rgba(34, 197, 94, 0.8)';

            } catch (error) {
                console.error('Error loading swing trading data:', error);
                document.getElementById('swing-loading').innerHTML = `
                    <div style="text-align: center; padding: 2rem; opacity: 0.7; color: #ef4444;">
                        <div style="font-size: 1rem; margin-bottom: 0.5rem;">‚ö†Ô∏è ${error.name === 'AbortError' ? 'Request Timeout' : 'API Error'}</div>
                        <div style="font-size: 0.8rem;">Will retry in 5 minutes...</div>
                    </div>
                `;
                document.getElementById('swing-status').textContent = error.name === 'AbortError' ? 'Timeout' : 'Error';
                document.getElementById('swing-status').style.background = 'rgba(239, 68, 68, 0.8)';
            }
        }

        // Advanced Tools Link Management
        function editAdvancedToolLink() {
            const currentLink = localStorage.getItem('morningDashboard_advancedToolsLink') || '#';
            const newLink = prompt('Enter the URL for your Advanced Trading Tools:', currentLink === '#' ? '' : currentLink);
            
            if (newLink !== null && newLink.trim() !== '') {
                const validLink = newLink.startsWith('http') ? newLink : 'https://' + newLink;
                localStorage.setItem('morningDashboard_advancedToolsLink', validLink);
                updateAdvancedToolsButton(validLink);
            }
        }

        function updateAdvancedToolsButton(link) {
            const button = document.getElementById('advanced-tools-btn');
            if (link && link !== '#') {
                button.innerHTML = '&#128295; Advanced Trading Tools';
                button.onclick = function() {
                    window.open(link, '_blank');
                };
            } else {
                button.innerHTML = '&#128295; Advanced Trading Tools';
                button.onclick = editAdvancedToolLink;
            }
        }

        function initializeAdvancedToolsLink() {
            const savedLink = localStorage.getItem('morningDashboard_advancedToolsLink');
            updateAdvancedToolsButton(savedLink);
        }

        // Learning System Functions
        const DEFAULT_LEARNING_DATA = {
            bibleVerses: [
                {
                    id: 'jer2911',
                    reference: 'Jeremiah 29:11',
                    text: 'For I know the plans I have for you, declares the Lord, plans to prosper you and not to harm you, to give you hope and a future.',
                    nextReview: new Date().toISOString().split('T')[0],
                    reviewCount: 0,
                    interval: 1,
                    easiness: 2.5
                }
            ],
            vocabulary: [
                {
                    id: 'articulate1',
                    word: 'articulate',
                    definition: 'Having or showing the ability to speak fluently and coherently',
                    usage: 'She was very articulate in explaining her position during the debate.',
                    nextReview: new Date().toISOString().split('T')[0],
                    reviewCount: 0,
                    interval: 1,
                    easiness: 2.5
                }
            ],
            facts: [
                {
                    id: 'memory1',
                    title: 'Memory Palace Technique',
                    content: 'The Memory Palace (Method of Loci) is 2000+ years old. Ancient Greeks used it to remember entire speeches. It works by associating information with specific locations in a familiar place.',
                    nextReview: new Date().toISOString().split('T')[0],
                    reviewCount: 0,
                    interval: 1,
                    easiness: 2.5
                }
            ],
            stats: {
                level: 1,
                xp: 0,
                streak: 0,
                lastStudyDate: null,
                achievements: []
            }
        };

        function getLearningData() {
            const stored = localStorage.getItem('morningDashboard_learning');
            if (stored) {
                return JSON.parse(stored);
            } else {
                saveLearningData(DEFAULT_LEARNING_DATA);
                return DEFAULT_LEARNING_DATA;
            }
        }

        function saveLearningData(data) {
            localStorage.setItem('morningDashboard_learning', JSON.stringify(data));
        }

        function loadLearningSystem() {
            const data = getLearningData();
            
            // Update stats display
            const level = calculateLevel(data.stats.xp);
            const levelTitle = getLevelTitle(level);
            document.getElementById('learning-level').textContent = `Level ${level} - ${levelTitle}`;
            document.getElementById('learning-xp').textContent = `${data.stats.xp} XP`;
            document.getElementById('learning-streak').textContent = `${data.stats.streak} day streak`;
        }

        function calculateLevel(xp) {
            let level = 1;
            let requiredXP = 100;
            let totalRequired = 0;
            
            while (xp >= totalRequired + requiredXP) {
                totalRequired += requiredXP;
                level++;
                requiredXP += 50;
            }
            
            return level;
        }

        function getLevelTitle(level) {
            const titles = [
                'Beginner Speaker', 'Developing Speaker', 'Competent Speaker',
                'Skilled Speaker', 'Advanced Speaker', 'Expert Speaker',
                'Master Speaker', 'Legendary Speaker'
            ];
            return titles[Math.min(level - 1, titles.length - 1)] || 'Legendary Speaker';
        }

        function reviewBible(difficulty) {
            updateReview('bible', difficulty);
        }

        function reviewVocab(difficulty) {
            updateReview('vocab', difficulty);
        }

        function reviewFact(difficulty) {
            updateReview('fact', difficulty);
        }

        function updateReview(type, difficulty) {
            const data = getLearningData();
            const xpMap = { 'struggling': 5, 'getting-it': 8, 'got-it': 12, 'mastered': 20 };
            data.stats.xp += xpMap[difficulty] || 5;
            
            const today = new Date().toISOString().split('T')[0];
            const lastStudyDate = data.stats.lastStudyDate;
            
            if (!lastStudyDate) {
                data.stats.streak = 1;
            } else {
                const daysDiff = Math.floor((new Date(today) - new Date(lastStudyDate)) / (1000 * 60 * 60 * 24));
                if (daysDiff === 1) {
                    data.stats.streak++;
                } else if (daysDiff > 1) {
                    data.stats.streak = 1;
                }
            }
            
            data.stats.lastStudyDate = today;
            saveLearningData(data);
            loadLearningSystem();
        }

        function showAddVerseModal() {
            const reference = prompt('Enter Bible verse reference:');
            if (!reference) return;
            const text = prompt('Enter the verse text:');
            if (!text) return;
            
            const data = getLearningData();
            const newVerse = {
                id: 'verse_' + Date.now(),
                reference: reference,
                text: text,
                nextReview: new Date().toISOString().split('T')[0],
                reviewCount: 0,
                interval: 1,
                easiness: 2.5
            };
            
            data.bibleVerses.push(newVerse);
            saveLearningData(data);
        }

        function showAddVocabModal() {
            const word = prompt('Enter vocabulary word:');
            if (!word) return;
            const definition = prompt('Enter definition:');
            if (!definition) return;
            const usage = prompt('Enter example usage:');
            if (!usage) return;
            
            const data = getLearningData();
            const newWord = {
                id: 'vocab_' + Date.now(),
                word: word,
                definition: definition,
                usage: usage,
                nextReview: new Date().toISOString().split('T')[0],
                reviewCount: 0,
                interval: 1,
                easiness: 2.5
            };
            
            data.vocabulary.push(newWord);
            saveLearningData(data);
        }

        function showAddFactModal() {
            const title = prompt('Enter fact title:');
            if (!title) return;
            const content = prompt('Enter fact content:');
            if (!content) return;
            
            const data = getLearningData();
            const newFact = {
                id: 'fact_' + Date.now(),
                title: title,
                content: content,
                nextReview: new Date().toISOString().split('T')[0],
                reviewCount: 0,
                interval: 1,
                easiness: 2.5
            };
            
            data.facts.push(newFact);
            saveLearningData(data);
        }

        function showProgressTree() {
            const data = getLearningData();
            
            const modalHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center;" onclick="closeProgressModal()">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2rem; border-radius: 16px; max-width: 800px; max-height: 80vh; overflow-y: auto; color: white;" onclick="event.stopPropagation()">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h2 style="margin: 0;">&#127795; Learning Progress Tree</h2>
                            <button onclick="closeProgressModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">&#10006; Close</button>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.2);">
                            <div style="display: flex; justify-content: space-around;">
                                <div>
                                    <div style="font-size: 2rem; font-weight: 600; color: #FFD700;">${calculateLevel(data.stats.xp)}</div>
                                    <div style="font-size: 0.9rem; opacity: 0.8;">Level</div>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: 600; color: #4CAF50;">${data.stats.xp}</div>
                                    <div style="font-size: 0.9rem; opacity: 0.8;">Total XP</div>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: 600; color: #FF9800;">${data.stats.streak}</div>
                                    <div style="font-size: 0.9rem; opacity: 0.8;">Day Streak</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            const modalDiv = document.createElement('div');
            modalDiv.id = 'progress-modal';
            modalDiv.innerHTML = modalHTML;
            document.body.appendChild(modalDiv);
        }

        function closeProgressModal() {
            const modal = document.getElementById('progress-modal');
            if (modal) {
                modal.remove();
            }
        }

        function clearLearningData() {
            if (confirm('This will reset all your learning progress. Are you sure?')) {
                localStorage.removeItem('morningDashboard_learning');
                loadLearningSystem();
            }
        }

        function openDictionary(word) {
            window.open(`https://www.dictionary.com/browse/${word}`, '_blank');
        }

        function previousBibleCard() { console.log('Previous Bible verse'); }
        function nextBibleCard() { console.log('Next Bible verse'); }
        function previousVocabCard() { console.log('Previous vocabulary word'); }
        function nextVocabCard() { console.log('Next vocabulary word'); }
        function previousFactCard() { console.log('Previous fact'); }
        function nextFactCard() { console.log('Next fact'); }

        // Gratitude System
        function initializeGratitudeForm() {
            const form = document.getElementById('gratitude-form');
            if (form) {
                form.addEventListener('submit', handleGratitudeSubmit);
            }
        }

        function handleGratitudeSubmit(event) {
            event.preventDefault();
            
            const gratitude1 = document.getElementById('gratitude-1').value.trim();
            const gratitude2 = document.getElementById('gratitude-2').value.trim();
            const gratitude3 = document.getElementById('gratitude-3').value.trim();
            
            if (!gratitude1 && !gratitude2 && !gratitude3) {
                showGratitudeFeedback('Please fill in at least one gratitude item', 'rgba(255,152,0,0.9)');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const gratitudeEntry = {
                date: today,
                timestamp: new Date().toISOString(),
                items: [gratitude1, gratitude2, gratitude3].filter(item => item.length > 0)
            };
            
            let gratitudeHistory = JSON.parse(localStorage.getItem('morningDashboard_gratitude') || '[]');
            gratitudeHistory = gratitudeHistory.filter(entry => entry.date !== today);
            gratitudeHistory.unshift(gratitudeEntry);
            gratitudeHistory = gratitudeHistory.slice(0, 30);
            
            localStorage.setItem('morningDashboard_gratitude', JSON.stringify(gratitudeHistory));
            
            showGratitudeFeedback('Thank you for taking time to reflect on your blessings!', 'rgba(76,175,80,0.9)');
            
            document.getElementById('gratitude-1').value = '';
            document.getElementById('gratitude-2').value = '';
            document.getElementById('gratitude-3').value = '';
        }

        function showGratitudeFeedback(message, backgroundColor) {
            const feedbackElement = document.getElementById('gratitude-feedback');
            feedbackElement.textContent = message;
            feedbackElement.style.backgroundColor = backgroundColor;
            feedbackElement.style.padding = '0.8rem';
            feedbackElement.style.borderRadius = '8px';
            feedbackElement.style.opacity = '1';
            
            setTimeout(() => {
                feedbackElement.style.opacity = '0';
                setTimeout(() => {
                    feedbackElement.style.backgroundColor = '';
                    feedbackElement.style.padding = '';
                    feedbackElement.style.borderRadius = '';
                }, 300);
            }, 4000);
        }

        function loadTodaysGratitude() {
            const today = new Date().toISOString().split('T')[0];
            const gratitudeHistory = JSON.parse(localStorage.getItem('morningDashboard_gratitude') || '[]');
            const todaysEntry = gratitudeHistory.find(entry => entry.date === today);
            
            if (todaysEntry && todaysEntry.items.length > 0) {
                if (todaysEntry.items[0]) document.getElementById('gratitude-1').value = todaysEntry.items[0];
                if (todaysEntry.items[1]) document.getElementById('gratitude-2').value = todaysEntry.items[1];
                if (todaysEntry.items[2]) document.getElementById('gratitude-3').value = todaysEntry.items[2];
            }
        }

        // Initialize dashboard
        console.log('Morning Update Dashboard starting...');
        
        updateFlipClock();
        updateDate();
        updateWeather();
        loadCalendarEvents();
        loadTasks();
        
        try {
            loadLearningSystem();
        } catch (error) {
            console.log('Learning system initialized with defaults');
        }
        
        initializeGratitudeForm();
        loadTodaysGratitude();
        initializeAdvancedToolsLink();
        loadLiveCryptoData();
        loadDailySpeakerTip();
        loadDailyDevotional();
        loadSwingTradingData();
        loadMoonshotData();
        
        console.log('Dashboard initialization complete');
        
        // Update intervals
        setInterval(() => {
            updateFlipClock();
            updateDate();
        }, 60000);
        
        setInterval(() => {
            loadCalendarEvents();
            loadTasks();
        }, 120000);
        
        // Toggle functions for show more/less functionality
        function toggleSwingDisplay() {
            const button = document.getElementById('swing-show-all');
            const currentlyShowing = button.dataset.showing === 'true';
            button.dataset.showing = !currentlyShowing;
            loadSwingTradingData(); // Reload with new display state
        }

        function toggleMoonshotDisplay() {
            const button = document.getElementById('moonshot-show-all');
            const currentlyShowing = button.dataset.showing === 'true';
            button.dataset.showing = !currentlyShowing;
            loadMoonshotData(); // Reload with new display state
        }

        setInterval(updateWeather, 600000);
        setInterval(loadLiveCryptoData, 300000);
        setInterval(loadSwingTradingData, 420000); // Refresh swing trading every 7 minutes
        setInterval(loadMoonshotData, 900000); // Refresh moonshots every 15 minutes
        
        // Initialize sticky notes
        loadStickyNotes();
    </script>

    <!-- STICKY NOTES SECTION - Individual Bubbles -->
    <div style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); padding: 2rem; border-radius: 16px; margin-bottom: 2rem; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2 style="color: white; margin: 0; font-size: 1.4rem; font-weight: 600;">üìù Sticky Notes</h2>
            <button onclick="addStickyNote()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; color: white; padding: 0.7rem 1.5rem; border-radius: 10px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); transition: all 0.3s ease;">
                + Add Note
            </button>
        </div>
        
        <!-- Sticky Notes Grid -->
        <div id="sticky-notes-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; min-height: 100px;">
            <!-- Sticky notes will be dynamically added here -->
        </div>
        
        <div style="text-align: center; margin-top: 1rem; color: rgba(255, 255, 255, 0.6); font-size: 0.8rem;">
            Click notes to edit ‚Ä¢ Each note saves automatically
        </div>
    </div>

    <script>
        let stickyNotes = [];
        let noteIdCounter = 1;

        // Sticky Note Colors
        const noteColors = [
            '#fef3c7', // Light yellow
            '#fecaca', // Light red/pink
            '#bbf7d0', // Light green
            '#bfdbfe', // Light blue
            '#e9d5ff', // Light purple
            '#fed7aa', // Light orange
            '#f3f4f6', // Light gray
            '#fde68a'  // Bright yellow
        ];

        function addStickyNote(text = '', color = null) {
            const noteId = 'note-' + noteIdCounter++;
            const noteColor = color || noteColors[Math.floor(Math.random() * noteColors.length)];
            
            const note = {
                id: noteId,
                text: text,
                color: noteColor,
                timestamp: Date.now()
            };
            
            stickyNotes.push(note);
            renderStickyNote(note);
            saveStickyNotes();
        }

        function renderStickyNote(note) {
            const container = document.getElementById('sticky-notes-container');
            
            const noteElement = document.createElement('div');
            noteElement.id = note.id;
            noteElement.innerHTML = `
                <div style="
                    background: ${note.color}; 
                    padding: 1rem; 
                    border-radius: 12px; 
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); 
                    position: relative; 
                    min-height: 120px;
                    border: 2px solid rgba(0, 0, 0, 0.1);
                    transition: all 0.3s ease;
                    cursor: pointer;
                " 
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0, 0, 0, 0.25)'"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.2)'"
                >
                    <!-- Delete Button -->
                    <button onclick="deleteStickyNote('${note.id}')" 
                            style="
                                position: absolute; 
                                top: 8px; 
                                right: 8px; 
                                background: rgba(239, 68, 68, 0.8); 
                                border: none; 
                                color: white; 
                                width: 24px; 
                                height: 24px; 
                                border-radius: 50%; 
                                cursor: pointer; 
                                font-size: 14px; 
                                display: flex; 
                                align-items: center; 
                                justify-content: center;
                                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
                            " 
                            title="Delete note">√ó</button>
                    
                    <!-- Color Picker -->
                    <div style="position: absolute; top: 8px; left: 8px;">
                        <input type="color" value="${note.color}" 
                               onchange="changeStickyNoteColor('${note.id}', this.value)"
                               style="
                                   width: 24px; 
                                   height: 24px; 
                                   border: none; 
                                   border-radius: 50%; 
                                   cursor: pointer;
                                   box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
                               " 
                               title="Change color">
                    </div>
                    
                    <!-- Note Content -->
                    <div contenteditable="true" 
                         style="
                             outline: none; 
                             margin-top: 35px; 
                             color: #1f2937; 
                             font-size: 14px; 
                             line-height: 1.4; 
                             min-height: 60px;
                             font-weight: 500;
                         " 
                         oninput="updateStickyNoteText('${note.id}', this.textContent)"
                         onclick="event.stopPropagation()"
                         placeholder="Click to add text...">${note.text}</div>
                </div>
            `;
            
            container.appendChild(noteElement);
        }

        function deleteStickyNote(noteId) {
            if (confirm('Delete this note?')) {
                // Remove from array
                stickyNotes = stickyNotes.filter(note => note.id !== noteId);
                
                // Remove from DOM
                const noteElement = document.getElementById(noteId);
                if (noteElement) {
                    noteElement.remove();
                }
                
                saveStickyNotes();
            }
        }

        function updateStickyNoteText(noteId, text) {
            const note = stickyNotes.find(n => n.id === noteId);
            if (note) {
                note.text = text;
                saveStickyNotes();
            }
        }

        function changeStickyNoteColor(noteId, color) {
            const note = stickyNotes.find(n => n.id === noteId);
            if (note) {
                note.color = color;
                
                // Update the background color in DOM
                const noteElement = document.getElementById(noteId);
                if (noteElement) {
                    const noteDiv = noteElement.querySelector('div');
                    noteDiv.style.background = color;
                }
                
                saveStickyNotes();
            }
        }

        function saveStickyNotes() {
            localStorage.setItem('morningDashboard_stickyNotes_v2', JSON.stringify(stickyNotes));
        }

        function loadStickyNotes() {
            const saved = localStorage.getItem('morningDashboard_stickyNotes_v2');
            if (saved) {
                try {
                    stickyNotes = JSON.parse(saved);
                    
                    // Update counter to avoid ID conflicts
                    const maxId = Math.max(...stickyNotes.map(note => parseInt(note.id.replace('note-', '')) || 0));
                    noteIdCounter = maxId + 1;
                    
                    // Render all saved notes
                    stickyNotes.forEach(note => renderStickyNote(note));
                } catch (e) {
                    console.log('Error loading sticky notes:', e);
                    stickyNotes = [];
                }
            }
            
            // Add a default note if none exist
            if (stickyNotes.length === 0) {
                addStickyNote('Welcome! Click to edit this note or add new ones with + Add Note', '#fef3c7');
            }
        }

        // Clear all notes function (if needed)
        function clearAllStickyNotes() {
            if (confirm('Delete all sticky notes? This cannot be undone.')) {
                stickyNotes = [];
                document.getElementById('sticky-notes-container').innerHTML = '';
                saveStickyNotes();
            }
        }
    </script>
</body>
</html>
<!-- API Access Test - Thu Feb 19 20:51:46 PST 2026 -->
