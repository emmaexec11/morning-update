<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° Devon's Complete Morning Dashboard</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
    
    <!-- Force fresh data - no caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 75%, #475569 100%);
            color: #f8fafc;
            line-height: 1.6;
            min-height: 100vh;
            padding: 1rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            background: linear-gradient(135deg, #60a5fa, #34d399, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .status-indicator {
            display: inline-block;
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .date-display {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        /* RETRO FLIP CLOCK STYLES */
        .flip-clock-container {
            text-align: center;
            margin: 2rem 0;
            padding: 2rem;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .flip-clock {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'Courier New', monospace;
        }

        .flip-digit {
            background: linear-gradient(to bottom, #333 0%, #222 50%, #111 100%);
            color: white;
            font-size: 4rem;
            font-weight: bold;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.3);
            position: relative;
            min-width: 5rem;
            text-align: center;
            transition: all 0.6s ease;
            border: 2px solid #444;
        }

        .flip-digit::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #444;
            z-index: 2;
        }

        .flip-separator {
            color: white;
            font-size: 3rem;
            font-weight: bold;
            animation: blink 2s infinite;
            margin: 0 0.5rem;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .flip-ampm {
            background: #f59e0b;
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            margin-left: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* GRID LAYOUT */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .clickable-header {
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            transition: all 0.2s ease;
        }

        .clickable-header:hover {
            color: #60a5fa;
            text-decoration: none;
        }

        /* WEATHER STYLES - BLUE GRADIENT */
        .weather-card {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
        }

        .weather-main {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .weather-emoji {
            font-size: 3rem;
        }

        .weather-temp {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .weather-condition {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .sun-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        .sun-item {
            text-align: center;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .sun-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .sun-time {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .sun-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* CALENDAR STYLES - GREEN GRADIENT */
        .calendar-card {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        /* TASKS STYLES - PURPLE GRADIENT */
        .tasks-card {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            color: white;
        }

        /* TASK AND EVENT STYLES */
        .task-item, .event-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 4px solid rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
        }

        .task-item:hover, .event-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .task-content, .event-content {
            flex: 1;
        }

        .task-actions, .event-actions {
            display: flex;
            gap: 0.5rem;
        }

        .task-checkbox, .event-checkbox {
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }

        .task-checkbox:hover, .event-checkbox:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .add-task-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .add-task-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        /* CRYPTO STYLES */
        .crypto-section {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 2rem 0;
        }

        .crypto-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .crypto-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            display: block;
            cursor: pointer;
        }

        .crypto-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .swing-item {
            border-left: 4px solid #3b82f6;
        }

        .moonshot-item {
            border-left: 4px solid #f59e0b;
        }

        .macro-item {
            border-left: 4px solid #10b981;
        }

        .arsenal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .arsenal-link {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 1rem;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .arsenal-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* HORIZONTAL FLASHCARD SYSTEM STYLES */
        .flashcard-section {
            grid-column: 1 / -1;
            margin: 2rem 0;
        }

        .flashcard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .flashcard-header h2 {
            font-size: 1.5rem;
            color: white;
            margin: 0;
        }

        .xp-bar-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(0, 0, 0, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .xp-level {
            font-weight: 700;
            font-size: 0.9rem;
            color: #fbbf24;
        }

        .xp-bar {
            width: 120px;
            height: 8px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 4px;
            overflow: hidden;
        }

        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .xp-text {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .flashcard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .flashcard {
            border-radius: 16px;
            padding: 1.5rem;
            min-height: 280px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .flashcard:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }

        .flashcard-bible {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 50%, #5b21b6 100%);
        }

        .flashcard-vocab {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 50%, #dc2626 100%);
        }

        .flashcard-facts {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 50%, #be185d 100%);
        }

        .flashcard-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .flashcard-category {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            font-size: 1rem;
            color: white;
        }

        .flashcard-count {
            font-size: 0.75rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.6rem;
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.9);
        }

        .flashcard-add-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .flashcard-add-btn:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: scale(1.1);
        }

        .flashcard-prompt {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
        }

        .flashcard-subtitle {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1rem;
        }

        .flashcard-answer {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: none;
            animation: fadeSlideIn 0.3s ease;
        }

        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .flashcard-answer-text {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.95);
            line-height: 1.5;
        }

        .flashcard-answer-example {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
            margin-top: 0.5rem;
        }

        .show-answer-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            transition: all 0.2s ease;
            margin-top: auto;
        }

        .show-answer-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .spaced-rep-buttons {
            display: flex;
            gap: 0.4rem;
            margin-top: 0.75rem;
            display: none;
        }

        .sr-btn {
            flex: 1;
            border: none;
            padding: 0.5rem 0.4rem;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            transition: all 0.2s ease;
            text-align: center;
        }

        .sr-btn:hover {
            opacity: 0.85;
            transform: translateY(-1px);
        }

        .sr-again { background: #ef4444; }
        .sr-hard { background: #f97316; }
        .sr-good { background: #eab308; }
        .sr-easy { background: #22c55e; }

        .flashcard-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 0.75rem;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .nav-dots {
            display: flex;
            gap: 0.4rem;
        }

        .nav-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.2s ease;
        }

        .nav-dot.active {
            background: white;
            transform: scale(1.2);
        }

        /* ADD CONTENT MODAL */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #1e293b;
            border-radius: 16px;
            padding: 2rem;
            width: 90%;
            max-width: 480px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .modal-content h3 {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }

        .modal-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
        }

        .modal-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .modal-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
        }

        .modal-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .modal-save-btn {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            color: white;
            transition: all 0.2s ease;
        }

        .modal-save-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .modal-cancel-btn {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.2s ease;
        }

        .modal-cancel-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* GRATITUDE SECTION */
        .gratitude-section {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(219, 39, 119, 0.1));
        }

        .gratitude-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .gratitude-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .save-gratitude-btn {
            background: #ec4899;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .save-gratitude-btn:hover {
            background: #db2777;
            transform: translateY(-1px);
        }

        .trading-arsenal {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* TOOLTIP STYLES */
        .crypto-tooltip {
            position: relative;
            cursor: pointer;
        }

        .crypto-tooltip .tooltip-text {
            visibility: hidden;
            opacity: 0;
            background: rgba(0, 0, 0, 0.9);
            color: #f8fafc;
            font-size: 0.75rem;
            line-height: 1.4;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            position: absolute;
            z-index: 100;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            min-width: 220px;
            max-width: 320px;
            text-align: left;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .crypto-tooltip .tooltip-text::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -6px;
            border-width: 6px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.9) transparent transparent transparent;
        }

        .crypto-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* SIGNAL COLOR CODING */
        .signal-bullish { color: #22c55e; }
        .signal-bearish { color: #ef4444; }
        .signal-neutral { color: #eab308; }
        .badge-bullish { background: rgba(34, 197, 94, 0.9); color: white; }
        .badge-bearish { background: rgba(239, 68, 68, 0.9); color: white; }
        .badge-neutral { background: rgba(234, 179, 8, 0.9); color: white; }

        /* LOADING ANIMATIONS */
        .loading {
            opacity: 0.7;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .crypto-loading {
            text-align: center;
            padding: 2rem 1rem;
            opacity: 0.7;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .crypto-error {
            padding: 1rem;
            background: rgba(239, 68, 68, 0.15);
            border-left: 4px solid #ef4444;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .error {
            background: rgba(239, 68, 68, 0.2);
            border-left: 4px solid #ef4444;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .crypto-grid {
                grid-template-columns: 1fr;
            }
            .flip-digit {
                font-size: 2.5rem;
                padding: 0.75rem 1rem;
            }
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .flashcard-grid {
                grid-template-columns: 1fr;
            }
            .flashcard-header {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container" style="max-width: 1400px; margin: 0 auto;">
        <div class="header">
            <h1>‚ö° Devon's Complete Morning Dashboard</h1>
            <div class="status-indicator">üî¥ LIVE DATA ‚Ä¢ Last Refreshed: <span id="last-refreshed">Loading...</span></div>
            <div class="date-display" id="current-date">Loading date...</div>
        </div>

        <!-- RETRO FLIP CLOCK -->
        <div class="flip-clock-container">
            <div class="flip-clock">
                <div class="flip-digit" id="hour1">0</div>
                <div class="flip-digit" id="hour2">0</div>
                <div class="flip-separator">:</div>
                <div class="flip-digit" id="min1">0</div>
                <div class="flip-digit" id="min2">0</div>
                <div class="flip-ampm" id="ampm">AM</div>
            </div>
            <div style="margin-top: 1rem; color: rgba(255, 255, 255, 0.8);">Pacific Time ‚Ä¢ Live Updates Every Minute</div>
        </div>

        <div class="dashboard-grid">
            <!-- WEATHER -->
            <div class="card weather-card">
                <h2>‚õÖ Kelowna Weather (Live)</h2>
                <div class="weather-main">
                    <div class="weather-emoji" id="weather-icon">üå§Ô∏è</div>
                    <div>
                        <div class="weather-temp" id="weather-temp">Loading...</div>
                        <div class="weather-condition" id="weather-condition">Fetching live data...</div>
                    </div>
                </div>
                <div class="sun-info">
                    <div class="sun-item">
                        <div class="sun-icon">üåÖ</div>
                        <div class="sun-time" id="sunrise">--:--</div>
                        <div class="sun-label">Sunrise</div>
                    </div>
                    <div class="sun-item">
                        <div class="sun-icon">üåá</div>
                        <div class="sun-time" id="sunset">--:--</div>
                        <div class="sun-label">Sunset</div>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                    <div style="text-align: center;">
                        <div>üå°Ô∏è High/Low</div>
                        <div id="temp-range">--¬∞C / --¬∞C</div>
                    </div>
                    <div style="text-align: center;">
                        <div>üí® Wind</div>
                        <div id="wind-speed">-- km/h</div>
                    </div>
                </div>
            </div>

            <!-- CALENDAR -->
            <div class="card calendar-card">
                <h2>
                    <a href="https://calendar.google.com/calendar/u/0/r/week" target="_blank" class="clickable-header">
                        üìÖ Google Calendar (Live)
                    </a>
                </h2>
                <div id="calendar-events">
                    <div class="event-item loading">
                        <div class="event-content">
                            <div style="font-weight: 600;">Loading calendar events...</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">Fetching from Google Calendar API</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TASKS -->
            <div class="card tasks-card">
                <h2>
                    <a href="https://tasks.google.com/tasks/" target="_blank" class="clickable-header">
                        üìù Google Tasks (Live)
                    </a>
                    <button class="add-task-btn" onclick="addNewTask()">+ Add Task</button>
                </h2>
                <div id="task-list">
                    <div class="task-item loading">
                        <div class="task-content">
                            <div style="font-weight: 600;">Loading tasks...</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">Fetching from Google Tasks API</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CRYPTO INTELLIGENCE SECTION -->
        <div class="crypto-section">
            <h2 style="color: white; margin-bottom: 1.5rem;">üöÄ Live Crypto Intelligence - Your Trading Strategy</h2>
            
            <div class="crypto-grid">
                <div>
                    <h3 style="color: white; margin-bottom: 1rem;">üìà Swing Trades (Outperforming BTC)</h3>
                    <div id="swing-crypto">
                        <div class="crypto-item swing-item loading">
                            <div style="font-weight: 600;">Loading swing trades...</div>
                            <div style="font-size: 0.8rem; opacity: 0.8;">Finding coins outperforming Bitcoin</div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: white; margin-bottom: 1rem;">üåô Moonshots (Social Spikes)</h3>
                    <div id="moonshot-crypto">
                        <div class="crypto-item moonshot-item loading">
                            <div style="font-weight: 600;">Loading moonshot opportunities...</div>
                            <div style="font-size: 0.8rem; opacity: 0.8;">Scanning Reddit & social sentiment</div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: white; margin-bottom: 1rem;">üèõÔ∏è Macro Intelligence</h3>
                    <div id="macro-indicators">
                        <div class="crypto-item macro-item loading">
                            <div style="font-size: 0.8rem; color: rgba(255,255,255,0.9); font-weight: 600;">DXY Dollar Index</div>
                            <div style="font-size: 1.6rem; font-weight: 800; margin: 0.5rem 0; color: white;">Loading...</div>
                            <div style="font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 12px; background: rgba(255,255,255,0.9); color: #059669; font-weight: 700;">MONITORING</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CRYPTO NEWS -->
            <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid rgba(255, 255, 255, 0.3);">
                <h3 style="color: white; margin-bottom: 1rem;">üêã Whale Flows & Token Unlocks</h3>
                <div id="crypto-news">
                    <div style="padding: 1rem; background: linear-gradient(135deg, #7c3aed, #8b5cf6); border-radius: 10px; margin-bottom: 0.75rem; border: 1px solid rgba(255,255,255,0.3);" class="loading">
                        <div style="font-weight: 700; margin-bottom: 0.5rem; font-size: 0.9rem; color: white;">Loading crypto intelligence...</div>
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.9);">üìÖ Fetching market-moving developments</div>
                    </div>
                </div>
            </div>

            <!-- TRADING ARSENAL -->
            <div class="trading-arsenal">
                <h3 style="color: white; margin-bottom: 1rem;">üéØ Your Trading Arsenal</h3>
                <div class="arsenal-grid">
                    <a href="https://www.tradingview.com/chart/?symbol=BTCUSDT" target="_blank" class="arsenal-link">
                        <div style="font-weight: 700; font-size: 0.9rem; color: #f59e0b;">üìà BTC Chart</div>
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.9);">TradingView</div>
                    </a>
                    <a href="https://banterbubbles.com" target="_blank" class="arsenal-link">
                        <div style="font-weight: 700; font-size: 0.9rem; color: #8b5cf6;">ü´ß Banter Bubbles</div>
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.9);">Market Sentiment</div>
                    </a>
                    <a href="https://coinmarketcap.com" target="_blank" class="arsenal-link">
                        <div style="font-weight: 700; font-size: 0.9rem; color: #10b981;">üí∞ CoinMarketCap</div>
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.9);">Market Data</div>
                    </a>
                    <a href="https://lunarcrush.com" target="_blank" class="arsenal-link">
                        <div style="font-weight: 700; font-size: 0.9rem; color: #06b6d4;">üåô LunarCrush</div>
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.9);">Social Analytics</div>
                    </a>
                    <a href="https://cryptopanic.com" target="_blank" class="arsenal-link">
                        <div style="font-weight: 700; font-size: 0.9rem; color: #f59e0b;">üì∞ CryptoPanic</div>
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.9);">Breaking News</div>
                    </a>
                    <a href="https://cointelegraph.com" target="_blank" class="arsenal-link">
                        <div style="font-weight: 700; font-size: 0.9rem; color: #ec4899;">üì∞ CoinTelegraph</div>
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.9);">Market Analysis</div>
                    </a>
                </div>
            </div>
        </div>

        <!-- DAILY GRATITUDE -->
        <div class="card gratitude-section">
            <h2>üíù Daily Gratitude</h2>
            <div>
                <input type="text" class="gratitude-input" id="gratitude1" placeholder="1. I am grateful for...">
                <input type="text" class="gratitude-input" id="gratitude2" placeholder="2. I am grateful for...">
                <input type="text" class="gratitude-input" id="gratitude3" placeholder="3. I am grateful for...">
                <button class="save-gratitude-btn" onclick="saveGratitude()">üíæ Save Today's Gratitude</button>
                <div id="gratitude-status" style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.8;"></div>
            </div>
        </div>
        <!-- HORIZONTAL 3-CARD FLASHCARD SYSTEM -->
        <div class="flashcard-section">
            <div class="flashcard-header">
                <h2>üß† Daily Learning Flashcards</h2>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div class="xp-bar-container">
                        <span class="xp-level" id="xp-level">Level 3</span>
                        <div class="xp-bar">
                            <div class="xp-bar-fill" id="xp-bar-fill" style="width: 65%;"></div>
                        </div>
                        <span class="xp-text"><span id="xp-current">325</span> / 500 XP</span>
                        <span style="font-size: 0.8rem; color: rgba(255,255,255,0.6);" id="streak-display">üî• 15 day streak</span>
                    </div>
                    <button onclick="openTreeModal()" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 600;">üå≥ Progress Tree</button>
                </div>
            </div>

            <div class="flashcard-grid">
                <!-- BIBLE VERSES CARD (Purple) -->
                <div class="flashcard flashcard-bible" id="bible-card">
                    <div class="flashcard-top">
                        <div>
                            <div class="flashcard-category">üìñ Bible Verses</div>
                            <span class="flashcard-count" id="bible-count">1 of 3</span>
                        </div>
                        <button class="flashcard-add-btn" onclick="openModal('bible')" title="Add verse">+</button>
                    </div>
                    <div class="flashcard-prompt" id="bible-prompt">Psalm 23:1</div>
                    <div class="flashcard-subtitle">Can you recite this verse?</div>
                    <div class="flashcard-answer" id="bible-answer">
                        <div class="flashcard-answer-text" id="bible-answer-text">"The Lord is my shepherd; I shall not want."</div>
                    </div>
                    <button class="show-answer-btn" id="bible-toggle-btn" onclick="toggleAnswer('bible')">Show Answer</button>
                    <div class="spaced-rep-buttons" id="bible-sr-buttons">
                        <button class="sr-btn sr-again" onclick="rateCard('bible', 1)">Again<br>1 day</button>
                        <button class="sr-btn sr-hard" onclick="rateCard('bible', 2)">Hard<br>2 days</button>
                        <button class="sr-btn sr-good" onclick="rateCard('bible', 3)">Good<br>4 days</button>
                        <button class="sr-btn sr-easy" onclick="rateCard('bible', 4)">Easy<br>2 wks</button>
                    </div>
                    <div class="flashcard-nav">
                        <button class="nav-btn" onclick="navigateCard('bible', -1)">&lt;</button>
                        <div class="nav-dots" id="bible-dots"></div>
                        <button class="nav-btn" onclick="navigateCard('bible', 1)">&gt;</button>
                    </div>
                </div>

                <!-- VOCABULARY CARD (Orange) -->
                <div class="flashcard flashcard-vocab" id="vocab-card">
                    <div class="flashcard-top">
                        <div>
                            <div class="flashcard-category">üìù Vocabulary</div>
                            <span class="flashcard-count" id="vocab-count">1 of 5</span>
                        </div>
                        <button class="flashcard-add-btn" onclick="openModal('vocab')" title="Add word">+</button>
                    </div>
                    <div class="flashcard-prompt" id="vocab-prompt">Eloquent</div>
                    <div class="flashcard-subtitle" id="vocab-subtitle">Click to see definition & usage</div>
                    <div class="flashcard-answer" id="vocab-answer">
                        <div class="flashcard-answer-text" id="vocab-answer-text"><strong>Definition:</strong> Fluent or persuasive in speaking or writing</div>
                        <div class="flashcard-answer-example" id="vocab-answer-example">"She delivered an eloquent speech that captivated the entire audience."</div>
                    </div>
                    <button class="show-answer-btn" id="vocab-toggle-btn" onclick="toggleAnswer('vocab')">Show Answer</button>
                    <div class="spaced-rep-buttons" id="vocab-sr-buttons">
                        <button class="sr-btn sr-again" onclick="rateCard('vocab', 1)">Again<br>1 day</button>
                        <button class="sr-btn sr-hard" onclick="rateCard('vocab', 2)">Hard<br>2 days</button>
                        <button class="sr-btn sr-good" onclick="rateCard('vocab', 3)">Good<br>4 days</button>
                        <button class="sr-btn sr-easy" onclick="rateCard('vocab', 4)">Easy<br>2 wks</button>
                    </div>
                    <div class="flashcard-nav">
                        <button class="nav-btn" onclick="navigateCard('vocab', -1)">&lt;</button>
                        <div class="nav-dots" id="vocab-dots"></div>
                        <button class="nav-btn" onclick="navigateCard('vocab', 1)">&gt;</button>
                    </div>
                </div>

                <!-- FACTS CARD (Pink) -->
                <div class="flashcard flashcard-facts" id="facts-card">
                    <div class="flashcard-top">
                        <div>
                            <div class="flashcard-category">üß† Facts</div>
                            <span class="flashcard-count" id="facts-count">1 of 4</span>
                        </div>
                        <button class="flashcard-add-btn" onclick="openModal('facts')" title="Add fact">+</button>
                    </div>
                    <div class="flashcard-prompt" id="facts-prompt">Public Speaking Fear</div>
                    <div class="flashcard-subtitle">Do you know this fact?</div>
                    <div class="flashcard-answer" id="facts-answer">
                        <div class="flashcard-answer-text" id="facts-answer-text">Glossophobia (fear of public speaking) affects approximately 75% of people. It's the #1 fear in America, ranked above death.</div>
                    </div>
                    <button class="show-answer-btn" id="facts-toggle-btn" onclick="toggleAnswer('facts')">Show Answer</button>
                    <div class="spaced-rep-buttons" id="facts-sr-buttons">
                        <button class="sr-btn sr-again" onclick="rateCard('facts', 1)">Again<br>1 day</button>
                        <button class="sr-btn sr-hard" onclick="rateCard('facts', 2)">Hard<br>2 days</button>
                        <button class="sr-btn sr-good" onclick="rateCard('facts', 3)">Good<br>4 days</button>
                        <button class="sr-btn sr-easy" onclick="rateCard('facts', 4)">Easy<br>2 wks</button>
                    </div>
                    <div class="flashcard-nav">
                        <button class="nav-btn" onclick="navigateCard('facts', -1)">&lt;</button>
                        <div class="nav-dots" id="facts-dots"></div>
                        <button class="nav-btn" onclick="navigateCard('facts', 1)">&gt;</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADD CONTENT MODALS -->
        <div class="modal-overlay" id="modal-bible">
            <div class="modal-content">
                <h3>üìñ Add Bible Verse</h3>
                <input class="modal-input" id="modal-bible-ref" placeholder="Reference (e.g., John 3:16)">
                <input class="modal-input" id="modal-bible-text" placeholder="Verse text">
                <div class="modal-actions">
                    <button class="modal-save-btn" style="background: #7c3aed;" onclick="addCard('bible')">Add Verse</button>
                    <button class="modal-cancel-btn" onclick="closeModal('bible')">Cancel</button>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="modal-vocab">
            <div class="modal-content">
                <h3>üìù Add Vocabulary Word</h3>
                <input class="modal-input" id="modal-vocab-word" placeholder="Word">
                <input class="modal-input" id="modal-vocab-def" placeholder="Definition">
                <input class="modal-input" id="modal-vocab-example" placeholder="Example sentence">
                <div class="modal-actions">
                    <button class="modal-save-btn" style="background: #f97316;" onclick="addCard('vocab')">Add Word</button>
                    <button class="modal-cancel-btn" onclick="closeModal('vocab')">Cancel</button>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="modal-facts">
            <div class="modal-content">
                <h3>üß† Add Fact</h3>
                <input class="modal-input" id="modal-facts-title" placeholder="Fact title (e.g., Speed of Light)">
                <input class="modal-input" id="modal-facts-text" placeholder="The fact / answer">
                <div class="modal-actions">
                    <button class="modal-save-btn" style="background: #ec4899;" onclick="addCard('facts')">Add Fact</button>
                    <button class="modal-cancel-btn" onclick="closeModal('facts')">Cancel</button>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="modal-tree">
            <div class="modal-content" style="width: 90%; max-width: 800px; height: 80vh; overflow-y: auto;">
                <h3 style="text-align: center; margin-bottom: 1.5rem;">üå≥ Learning Progress Tree</h3>
                <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 12px;">
                    
                    <!-- Daily Review Section -->
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: #ef4444; margin-bottom: 1rem;">üî¥ Daily Review (Learning Phase)</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            <span style="background: #ef4444; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Psalm 23:1 (Day 3)</span>
                            <span style="background: #ef4444; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Articulate (Day 2)</span>
                            <span style="background: #ef4444; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Memory Palace (Day 1)</span>
                        </div>
                    </div>

                    <!-- Weekly Review Section -->
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: #f97316; margin-bottom: 1rem;">üü† Weekly Review (Maintenance Phase)</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            <span style="background: #f97316; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Philippians 4:13</span>
                            <span style="background: #f97316; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Eloquent</span>
                            <span style="background: #f97316; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Public Speaking Fear</span>
                        </div>
                    </div>

                    <!-- Monthly Review Section -->
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: #22c55e; margin-bottom: 1rem;">üü¢ Monthly Review (Retention Phase)</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            <span style="background: #22c55e; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">John 3:16</span>
                            <span style="background: #22c55e; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Compelling</span>
                            <span style="background: #22c55e; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Speed of Light</span>
                        </div>
                    </div>

                    <!-- Mastered Section -->
                    <div style="margin-bottom: 1rem;">
                        <h4 style="color: #3b82f6; margin-bottom: 1rem;">üîµ Mastered (Long-term Archive)</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            <span style="background: #3b82f6; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Romans 8:28</span>
                            <span style="background: #3b82f6; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Pragmatic</span>
                            <span style="background: #3b82f6; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">Fibonacci Sequence</span>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 1.5rem; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">
                            üìä <strong>Total Items:</strong> 12 learned | 
                            üéØ <strong>Active:</strong> 3 daily + 3 weekly | 
                            üí™ <strong>Success Rate:</strong> 87%
                        </p>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 1.5rem;">
                    <button class="modal-cancel-btn" onclick="closeTreeModal()">Close</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // LIVE DATA SYSTEM - Update all components with fresh data
        let spacedRepetitionData = {};

        // Update flip clock time (4 digits only - no seconds) 
        function updateFlipClock() {
            const now = new Date();
            const pacificTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Los_Angeles"}));

            const hours = pacificTime.getHours();
            const minutes = pacificTime.getMinutes();

            const hour12 = hours === 0 ? 12 : (hours > 12 ? hours - 12 : hours);
            const ampm = hours >= 12 ? 'PM' : 'AM';

            const hourStr = hour12.toString().padStart(2, '0');
            const minStr = minutes.toString().padStart(2, '0');

            updateDigit('hour1', hourStr[0]);
            updateDigit('hour2', hourStr[1]);
            updateDigit('min1', minStr[0]);
            updateDigit('min2', minStr[1]);
            updateDigit('ampm', ampm);

            // Update last refreshed time
            document.getElementById('last-refreshed').textContent = pacificTime.toLocaleTimeString('en-US', {
                hour12: true,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        function updateDigit(id, newValue) {
            const element = document.getElementById(id);
            if (element && element.textContent !== newValue) {
                element.style.transform = 'rotateX(90deg)';
                setTimeout(() => {
                    element.textContent = newValue;
                    element.style.transform = 'rotateX(0deg)';
                }, 300);
            }
        }

        // Update date display
        function updateDate() {
            const now = new Date();
            const pacificTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Los_Angeles"}));
            document.getElementById('current-date').textContent = pacificTime.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Load live weather data
        async function loadWeatherData() {
            try {
                // Add cache-busting parameter
                const response = await fetch(`/weather-api?t=${Date.now()}`);
                if (response.ok) {
                    const data = await response.json();
                    
                    document.getElementById('weather-icon').textContent = data.icon || 'üå§Ô∏è';
                    document.getElementById('weather-temp').textContent = data.temperature || 'N/A';
                    document.getElementById('weather-condition').textContent = data.condition || 'Loading...';
                    document.getElementById('sunrise').textContent = data.sunrise || '--:--';
                    document.getElementById('sunset').textContent = data.sunset || '--:--';
                    document.getElementById('temp-range').textContent = `${data.high || '--¬∞C'} / ${data.low || '--¬∞C'}`;
                    document.getElementById('wind-speed').textContent = data.wind || '-- km/h';
                } else {
                    // Fallback to sample data
                    loadFallbackWeather();
                }
            } catch (error) {
                console.log('Weather loading error:', error);
                loadFallbackWeather();
            }
        }

        function loadFallbackWeather() {
            document.getElementById('weather-icon').textContent = '‚õÖ';
            document.getElementById('weather-temp').textContent = '6¬∞C';
            document.getElementById('weather-condition').textContent = 'Overcast clouds';
            document.getElementById('sunrise').textContent = '7:04 AM';
            document.getElementById('sunset').textContent = '5:19 PM';
            document.getElementById('temp-range').textContent = '8¬∞C / 2¬∞C';
            document.getElementById('wind-speed').textContent = '12 km/h';
        }

        // Dynamic token refresh system
        async function getAccessToken() {
            const credentials = {
                "refresh_token": "1//06pZHENOSKxTXCgYIARAAGAYSNwF-L9IraZ1g-rP258FGkJOF1SWOYKmkrDmMeJXKwbzyvjCGPbwGf8KyR0z0CS-su0Mxz90JPpc",
                "client_id": "310221293117-eiv0ouknutm3mjchgio5ceopf9hvbnr8.apps.googleusercontent.com",
                "client_secret": "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"
            };
            
            try {
                const response = await fetch('https://oauth2.googleapis.com/token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: `grant_type=refresh_token&refresh_token=${credentials.refresh_token}&client_id=${credentials.client_id}&client_secret=${credentials.client_secret}`
                });
                const data = await response.json();
                return data.access_token;
            } catch (error) {
                console.error('Token refresh failed:', error);
                return null;
            }
        }

        // Load calendar events with smart filtering (remove daily routines)
        async function loadCalendarData() {
            try {
                const today = new Date();
                const timeMin = today.toISOString().split('T')[0] + 'T00:00:00Z';
                const timeMax = today.toISOString().split('T')[0] + 'T23:59:59Z';

                // Get fresh access token
                const token = await getAccessToken();
                if (!token) {
                    throw new Error('Failed to get access token');
                }

                // Fetch from BOTH calendars: Devon's and Emma's
                const calendars = [
                    'devondoherty07@gmail.com',
                    'emma.exec.11@gmail.com'
                ];

                let allEvents = [];

                for (const calendarId of calendars) {
                    const response = await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?timeMin=${timeMin}&timeMax=${timeMax}&orderBy=startTime&singleEvents=true`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const events = data.items || [];
                        // Add source info to each event
                        events.forEach(event => {
                            event.calendarSource = calendarId === 'devondoherty07@gmail.com' ? 'Devon' : 'Emma';
                        });
                        allEvents = allEvents.concat(events);
                    } else {
                        console.warn(`Failed to fetch calendar for ${calendarId}:`, response.status);
                    }
                }

                // Sort all events by start time
                allEvents.sort((a, b) => {
                    const aStart = new Date(a.start?.dateTime || a.start?.date);
                    const bStart = new Date(b.start?.dateTime || b.start?.date);
                    return aStart - bStart;
                });

                const events = allEvents;
                    const container = document.getElementById('calendar-events');
                    
                    // Filter out routine events
                    const routineKeywords = ['Morning Routine', 'Power Hour', 'Workout', 'Wrap Up Day', 'Night Routine'];
                    const importantEvents = events.filter(event => 
                        !routineKeywords.some(keyword => 
                            event.summary && event.summary.includes(keyword)
                        )
                    );
                    
                    if (importantEvents.length > 0) {
                        container.innerHTML = importantEvents.slice(0, 5).map(event => `
                            <div class="event-item">
                                <div class="event-content">
                                    <div style="font-weight: 600;">${event.summary || 'Untitled Event'}</div>
                                    <div style="font-size: 0.9rem; opacity: 0.8;">
                                        ${event.start ? (event.start.dateTime ? new Date(event.start.dateTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'All Day') : 'All Day'}
                                    </div>
                                    ${event.location ? `<div style="font-size: 0.8rem; opacity: 0.7;">üìç ${event.location}</div>` : ''}
                                </div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = `
                            <div class="event-item">
                                <div class="event-content">
                                    <div>‚úÖ No notable events today</div>
                                    <div style="font-size: 0.9rem; opacity: 0.8;">Routine events filtered out</div>
                                </div>
                            </div>
                        `;
                    }
                } else {
                    loadFallbackCalendar();
                }
            } catch (error) {
                console.log('Calendar loading error:', error);
                loadFallbackCalendar();
            }
        }

        function loadFallbackCalendar() {
            const container = document.getElementById('calendar-events');
            container.innerHTML = `
                <div class="event-item">
                    <div class="event-content">
                        <div style="font-weight: 600;">Iulia's birthday</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">All Day</div>
                    </div>
                </div>
                <div class="event-item">
                    <div class="event-content">
                        <div style="font-weight: 600;">Team meeting</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">2:00 PM Today</div>
                        <div style="font-size: 0.8rem; opacity: 0.7;">üìç Video call</div>
                    </div>
                </div>
            `;
        }

        // Load tasks with interactive completion
        async function loadTasksData() {
            try {
                const container = document.getElementById('task-list');
                let allTasks = [];
                
                // Task lists with their IDs
                const taskLists = [
                    {id: 'MTUwNjQ0MzI1OTk0MTc2NDc5MzI6MDow', title: 'My Tasks'},
                    {id: 'c1JDcmNyaVd2TGprZk1NOFQ2bkFOakNsNjlEVG5JYW46MzA4OTYwMTIyNzE2NDQ4NjA5MzI6MA', title: 'This Week'},
                    {id: 'c1JDcmNyaVd2TGprZk1NOFQ2bkFOakNsNjlEVG5JYW46MzA4OTYwMTIyNzE2NDQ4NjA5MzI6MA', title: 'This Month'},  
                    {id: 'c1JDcmNyaVd2TGprZk1NOFQ2bkFOakNsNjlEVG5JYW46MzA4OTYwMTIyNzE2NDQ4NjA5MzI6MA', title: 'At Some Point'}
                ];

                // Get fresh access token for tasks
                const token = await getAccessToken();
                if (!token) {
                    throw new Error('Failed to get access token');
                }

                // Get tasks from all lists with fresh token
                for (let taskList of taskLists) {
                    const response = await fetch(`https://www.googleapis.com/tasks/v1/lists/${taskList.id}/tasks`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.items) {
                            // Only include incomplete tasks
                            const incompleteTasks = data.items
                                .filter(task => task.status !== 'completed')
                                .map(task => ({...task, listTitle: taskList.title}));
                            allTasks = [...allTasks, ...incompleteTasks];
                        }
                    }
                }
                    
                if (allTasks.length > 0) {
                    container.innerHTML = allTasks.slice(0, 5).map(task => `
                        <div class="task-item" id="task-${task.id}">
                            <div class="task-content">
                                <div style="font-weight: 600;">${task.title}</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">${task.listTitle} ‚Ä¢ ${task.due ? new Date(task.due).toLocaleDateString() : 'No due date'}</div>
                            </div>
                            <div class="task-actions">
                                <span class="task-checkbox" onclick="completeTask('${task.id}', '${task.title}')">
                                    ${task.status === 'completed' ? '‚úÖ' : '‚¨ú'}
                                </span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = `
                        <div class="task-item">
                            <div class="task-content">
                                <div>‚úÖ All tasks completed!</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">Great job staying organized</div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.log('Tasks loading error:', error);
                loadFallbackTasks();
            }
        }

        function loadFallbackTasks() {
            const container = document.getElementById('task-list');
            container.innerHTML = `
                <div class="task-item" id="task-1">
                    <div class="task-content">
                        <div style="font-weight: 600;">Review overnight crypto positions</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">Trading ‚Ä¢ Now</div>
                    </div>
                    <div class="task-actions">
                        <span class="task-checkbox" onclick="completeTask('1', 'Review crypto positions')">‚¨ú</span>
                    </div>
                </div>
                <div class="task-item" id="task-2">
                    <div class="task-content">
                        <div style="font-weight: 600;">Naturally Wyld marketing analysis</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">Business ‚Ä¢ Today</div>
                    </div>
                    <div class="task-actions">
                        <span class="task-checkbox" onclick="completeTask('2', 'Marketing analysis')">‚¨ú</span>
                    </div>
                </div>
                <div class="task-item" id="task-3">
                    <div class="task-content">
                        <div style="font-weight: 600;">Practice vocabulary words</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">Learning ‚Ä¢ Daily</div>
                    </div>
                    <div class="task-actions">
                        <span class="task-checkbox" onclick="completeTask('3', 'Practice vocabulary')">‚¨ú</span>
                    </div>
                </div>
            `;
        }

        // ========================================
        // CRYPTO INTELLIGENCE - Connected to localhost:8082
        // ========================================
        const CRYPTO_API = 'http://localhost:8082';

        function getSignalColor(impact) {
            if (!impact) return '#eab308';
            const upper = impact.toUpperCase();
            if (upper.includes('BULLISH') || upper === 'ACCUMULATING' || upper === 'NET INFLOWS') return '#22c55e';
            if (upper.includes('BEARISH')) return '#ef4444';
            return '#eab308';
        }

        function getSignalBadgeClass(impact) {
            if (!impact) return 'badge-neutral';
            const upper = impact.toUpperCase();
            if (upper.includes('BULLISH') || upper === 'ACCUMULATING' || upper === 'NET INFLOWS') return 'badge-bullish';
            if (upper.includes('BEARISH')) return 'badge-bearish';
            return 'badge-neutral';
        }

        function formatUSD(num) {
            if (num >= 1e9) return '$' + (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return '$' + (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return '$' + (num / 1e3).toFixed(0) + 'K';
            return '$' + Number(num).toFixed(2);
        }

        // Load swing trades from intelligence server
        async function loadSwingTrades() {
            const container = document.getElementById('swing-crypto');
            try {
                const response = await fetch(`${CRYPTO_API}/api/swing-trades`);
                if (!response.ok) throw new Error('API error');
                const trades = await response.json();

                if (!trades || trades.length === 0) {
                    container.innerHTML = '<div class="crypto-item swing-item"><div style="font-weight: 600;">No swing trade signals right now</div><div style="font-size: 0.8rem; opacity: 0.8;">Waiting for coins to outperform BTC by 5%+</div></div>';
                    return;
                }

                container.innerHTML = trades.map(coin => `
                    <div class="crypto-item swing-item crypto-tooltip" onclick="window.open('https://www.tradingview.com/chart/?symbol=${coin.symbol}USDT', '_blank')">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="font-weight: 800; font-size: 1.1rem;">${coin.symbol}</span>
                            <span style="color: #22c55e; font-weight: 700;">+${coin.outperformance.toFixed(1)}% vs BTC</span>
                        </div>
                        <div style="font-size: 0.9rem; margin-bottom: 0.5rem;">${coin.name} \u2022 #${coin.rank}</div>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
                            <span style="font-size: 0.7rem; padding: 0.15rem 0.5rem; border-radius: 12px; background: rgba(34,197,94,0.2); color: #22c55e; font-weight: 600;">24h: +${coin.change_24h.toFixed(1)}%</span>
                            <span style="font-size: 0.7rem; padding: 0.15rem 0.5rem; border-radius: 12px; background: rgba(34,197,94,0.2); color: #22c55e; font-weight: 600;">7d: +${coin.change_7d.toFixed(1)}%</span>
                            <span style="font-size: 0.7rem; padding: 0.15rem 0.5rem; border-radius: 12px; background: rgba(59,130,246,0.2); color: #60a5fa; font-weight: 600;">${coin.signal_strength}</span>
                        </div>
                        <div style="font-size: 0.75rem; opacity: 0.8;">${formatUSD(coin.price)} \u2022 Vol: ${formatUSD(coin.volume)}</div>
                        <span class="tooltip-text">Trend Score: ${coin.trend_score.toFixed(1)}/10 \u2022 Signal: ${coin.signal_strength} \u2022 Outperforming BTC by ${coin.outperformance.toFixed(1)}% over 7 days. Market cap: ${formatUSD(coin.market_cap)}</span>
                    </div>
                `).join('');
            } catch (error) {
                console.log('Swing trades error:', error);
                container.innerHTML = '<div class="crypto-item swing-item crypto-error">Failed to load swing trades. Is the intelligence server running on port 8082?</div>';
            }
        }

        // Load moonshots from intelligence server
        async function loadMoonshots() {
            const container = document.getElementById('moonshot-crypto');
            try {
                const response = await fetch(`${CRYPTO_API}/api/moonshots`);
                if (!response.ok) throw new Error('API error');
                const moonshots = await response.json();

                if (!moonshots || moonshots.length === 0) {
                    container.innerHTML = '<div class="crypto-item moonshot-item"><div style="font-weight: 600;">No moonshot signals detected</div><div style="font-size: 0.8rem; opacity: 0.8;">Scanning for volume spikes &amp; social sentiment</div></div>';
                    return;
                }

                container.innerHTML = moonshots.map(coin => `
                    <div class="crypto-item moonshot-item crypto-tooltip" onclick="window.open('https://www.tradingview.com/chart/?symbol=${coin.symbol}USDT', '_blank')">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="font-weight: 800; font-size: 1.1rem;">${coin.symbol}</span>
                            <span style="color: #f59e0b; font-weight: 700;">Score: ${coin.social_score.toFixed(1)}/10</span>
                        </div>
                        <div style="font-size: 0.9rem; margin-bottom: 0.5rem;">${coin.name}</div>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
                            <span style="font-size: 0.7rem; padding: 0.15rem 0.5rem; border-radius: 12px; background: rgba(245,158,11,0.2); color: #f59e0b; font-weight: 600;">1h: ${coin.change_1h > 0 ? '+' : ''}${coin.change_1h.toFixed(1)}%</span>
                            <span style="font-size: 0.7rem; padding: 0.15rem 0.5rem; border-radius: 12px; background: ${coin.change_24h > 0 ? 'rgba(34,197,94,0.2)' : 'rgba(239,68,68,0.2)'}; color: ${coin.change_24h > 0 ? '#22c55e' : '#ef4444'}; font-weight: 600;">24h: ${coin.change_24h > 0 ? '+' : ''}${coin.change_24h.toFixed(1)}%</span>
                            <span style="font-size: 0.7rem; padding: 0.15rem 0.5rem; border-radius: 12px; background: rgba(139,92,246,0.2); color: #a78bfa; font-weight: 600;">Risk: ${coin.risk_level}</span>
                        </div>
                        <div style="font-size: 0.75rem; opacity: 0.8;">Potential: ${coin.potential_return} \u2022 Vol/MC: ${(coin.volume_ratio * 100).toFixed(1)}%</div>
                        <span class="tooltip-text">Volume Ratio: ${(coin.volume_ratio * 100).toFixed(1)}% (high = unusual activity). Risk: ${coin.risk_level}. Potential return: ${coin.potential_return}. Price: ${formatUSD(coin.price)}</span>
                    </div>
                `).join('');
            } catch (error) {
                console.log('Moonshots error:', error);
                container.innerHTML = '<div class="crypto-item moonshot-item crypto-error">Failed to load moonshots. Is the intelligence server running on port 8082?</div>';
            }
        }

        // Load macro intelligence from intelligence server
        async function loadMacroData() {
            const container = document.getElementById('macro-indicators');
            try {
                const response = await fetch(`${CRYPTO_API}/api/macro`);
                if (!response.ok) throw new Error('API error');
                const macro = await response.json();

                if (!macro || Object.keys(macro).length === 0) {
                    container.innerHTML = '<div class="crypto-item macro-item"><div style="font-weight: 600;">Macro data unavailable</div></div>';
                    return;
                }

                let html = '';

                if (macro.dxy) {
                    html += `
                    <div class="crypto-item macro-item crypto-tooltip" onclick="window.open('https://www.tradingview.com/chart/?symbol=TVC:DXY', '_blank')">
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.9); font-weight: 600;">DXY Dollar Index</div>
                        <div style="font-size: 1.6rem; font-weight: 800; margin: 0.5rem 0; color: white;">${macro.dxy.value} ${macro.dxy.change_24h < 0 ? '\u2193' : '\u2191'}</div>
                        <div style="font-size: 0.75rem; margin-bottom: 0.5rem; color: ${getSignalColor(macro.dxy.crypto_impact)};">Trend: ${macro.dxy.trend} \u2022 ${macro.dxy.strength}</div>
                        <div style="font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 12px; display: inline-block;" class="${getSignalBadgeClass(macro.dxy.crypto_impact)}">${macro.dxy.crypto_impact}</div>
                        <span class="tooltip-text">${macro.dxy.tooltip}</span>
                    </div>`;
                }

                if (macro.fear_greed) {
                    const fgValue = macro.fear_greed.value;
                    const fgColor = fgValue < 30 ? '#ef4444' : fgValue > 70 ? '#22c55e' : '#eab308';
                    html += `
                    <div class="crypto-item macro-item crypto-tooltip">
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.9); font-weight: 600;">Fear & Greed Index</div>
                        <div style="font-size: 1.6rem; font-weight: 800; margin: 0.5rem 0; color: ${fgColor};">${fgValue}/100</div>
                        <div style="font-size: 0.75rem; margin-bottom: 0.5rem;">${macro.fear_greed.classification}</div>
                        <div style="font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 12px; display: inline-block;" class="${getSignalBadgeClass(macro.fear_greed.crypto_impact)}">${macro.fear_greed.crypto_impact.replace('_', ' ')}</div>
                        <span class="tooltip-text">${macro.fear_greed.tooltip}</span>
                    </div>`;
                }

                if (macro.fed_policy) {
                    html += `
                    <div class="crypto-item macro-item crypto-tooltip">
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.9); font-weight: 600;">Fed Policy</div>
                        <div style="font-size: 1.2rem; font-weight: 800; margin: 0.5rem 0; color: white;">${macro.fed_policy.current_rate}</div>
                        <div style="font-size: 0.75rem; margin-bottom: 0.5rem;">Rate cut prob: ${macro.fed_policy.rate_cut_probability}</div>
                        <div style="font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 12px; display: inline-block;" class="${getSignalBadgeClass(macro.fed_policy.crypto_impact)}">${macro.fed_policy.crypto_impact}</div>
                        <span class="tooltip-text">${macro.fed_policy.tooltip}</span>
                    </div>`;
                }

                if (macro.overall_regime) {
                    html += `
                    <div class="crypto-item macro-item crypto-tooltip" style="border-left: 4px solid ${getSignalColor(macro.overall_regime.status)};">
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.9); font-weight: 600;">Overall Market Regime</div>
                        <div style="font-size: 1.4rem; font-weight: 800; margin: 0.5rem 0; color: ${getSignalColor(macro.overall_regime.status)};">${macro.overall_regime.status}</div>
                        <div style="font-size: 0.75rem;">Confidence: ${macro.overall_regime.confidence} (${macro.overall_regime.signals_bullish}/${macro.overall_regime.signals_total} bullish)</div>
                        <span class="tooltip-text">Overall crypto regime based on DXY, Fear/Greed, and Fed policy signals. ${macro.overall_regime.signals_bullish} of ${macro.overall_regime.signals_total} indicators are bullish.</span>
                    </div>`;
                }

                container.innerHTML = html;
            } catch (error) {
                console.log('Macro data error:', error);
                container.innerHTML = '<div class="crypto-item macro-item crypto-error">Failed to load macro data. Is the intelligence server running on port 8082?</div>';
            }
        }

        // Load whale flows and token unlocks into the crypto news section
        async function loadCryptoIntel() {
            const container = document.getElementById('crypto-news');
            try {
                const [whaleRes, unlockRes] = await Promise.all([
                    fetch(`${CRYPTO_API}/api/whale-flows`),
                    fetch(`${CRYPTO_API}/api/token-unlocks`)
                ]);

                if (!whaleRes.ok && !unlockRes.ok) throw new Error('Both APIs failed');

                const whaleFlows = whaleRes.ok ? await whaleRes.json() : [];
                const tokenUnlocks = unlockRes.ok ? await unlockRes.json() : [];

                let html = '';

                if (whaleFlows && whaleFlows.length > 0) {
                    html += '<div style="font-weight: 700; font-size: 0.85rem; color: #a78bfa; margin-bottom: 0.75rem;">\ud83d\udc0b Whale Flows & Institutional Activity</div>';
                    html += whaleFlows.map(flow => `
                        <div class="crypto-tooltip" style="padding: 1rem; background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(37,99,235,0.2)); border-radius: 10px; margin-bottom: 0.75rem; border: 1px solid rgba(255,255,255,0.2); border-left: 4px solid ${getSignalColor(flow.impact)};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <span style="font-weight: 700; font-size: 0.9rem; color: white;">${flow.entity}</span>
                                <span style="font-size: 0.7rem; padding: 0.15rem 0.5rem; border-radius: 12px; font-weight: 600;" class="${getSignalBadgeClass(flow.impact)}">${flow.action}</span>
                            </div>
                            <div style="font-size: 0.85rem; color: rgba(255,255,255,0.95); margin-bottom: 0.25rem;">${flow.amount} \u2022 ${flow.asset}</div>
                            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">${flow.timeframe} \u2022 Confidence: ${flow.confidence}</div>
                            <span class="tooltip-text">${flow.tooltip}</span>
                        </div>
                    `).join('');
                }

                if (tokenUnlocks && tokenUnlocks.length > 0) {
                    html += '<div style="font-weight: 700; font-size: 0.85rem; color: #f59e0b; margin: 1.25rem 0 0.75rem 0;">\ud83d\udd13 Upcoming Token Unlocks</div>';
                    html += tokenUnlocks.map(unlock => {
                        const impactColor = unlock.impact === 'HIGH' ? '#ef4444' : unlock.impact === 'MEDIUM' ? '#eab308' : '#22c55e';
                        const daysUntil = Math.ceil((new Date(unlock.date) - new Date()) / (1000 * 60 * 60 * 24));
                        return `
                        <div class="crypto-tooltip" style="padding: 1rem; background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(217,119,6,0.15)); border-radius: 10px; margin-bottom: 0.75rem; border: 1px solid rgba(255,255,255,0.2); border-left: 4px solid ${impactColor};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <span style="font-weight: 700; font-size: 0.9rem; color: white;">${unlock.token}</span>
                                <span style="font-size: 0.7rem; padding: 0.15rem 0.5rem; border-radius: 12px; background: rgba(255,255,255,0.1); color: ${impactColor}; font-weight: 600;">Impact: ${unlock.impact}</span>
                            </div>
                            <div style="font-size: 0.85rem; color: rgba(255,255,255,0.95); margin-bottom: 0.25rem;">${unlock.amount} (${unlock.percentage_supply} of supply)</div>
                            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">Value: ${unlock.value_usd} \u2022 ${unlock.category} \u2022 ${daysUntil > 0 ? 'In ' + daysUntil + ' days' : 'Today!'}</div>
                            <span class="tooltip-text">${unlock.tooltip}</span>
                        </div>
                    `}).join('');
                }

                if (html) {
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div style="padding: 1rem; opacity: 0.7;">No whale flow or token unlock data available.</div>';
                }
            } catch (error) {
                console.log('Crypto intel error:', error);
                container.innerHTML = '<div class="crypto-error" style="padding: 1rem;">Failed to load whale flows & token unlocks. Is the intelligence server running on port 8082?</div>';
            }
        }

        // Mark calendar event as completed
        function markEventCompleted(eventId, eventTitle) {
            const checkbox = document.querySelector(`#event-${eventId} .event-checkbox`);
            const eventItem = document.getElementById(`event-${eventId}`);
            
            if (checkbox) {
                checkbox.textContent = '‚úÖ';
                if (eventItem) {
                    eventItem.style.opacity = '0.6';
                    eventItem.style.transform = 'scale(0.98)';
                }
                showToast(`üìÖ Event "${eventTitle}" marked as completed!`);
            }
        }

        // Complete task functionality with Google sync
        async function completeTask(taskId, taskTitle) {
            const checkbox = document.querySelector(`#task-${taskId} .task-checkbox`);
            const taskItem = document.getElementById('task-' + taskId);
            
            if (!checkbox || !taskItem) return;
            
            const isCompleted = checkbox.textContent === '‚úÖ';
            const newStatus = !isCompleted;
            
            // Update UI immediately
            checkbox.textContent = newStatus ? '‚úÖ' : '‚¨ú';
            taskItem.style.opacity = newStatus ? '0.6' : '1';
            taskItem.style.transform = newStatus ? 'scale(0.98)' : 'scale(1)';
            
            // Try to sync with Google Tasks API
            if (newStatus) {
                try {
                    // Find which task list this task belongs to
                    const taskLists = [
                        {id: 'MTUwNjQ0MzI1OTk0MTc2NDc5MzI6MDow', title: 'My Tasks'},
                        {id: 'c1JDcmNyaVd2TGprZk1NOFQ2bkFOakNsNjlEVG5JYW46MzA4OTYwMTIyNzE2NDQ4NjA5MzI6MA', title: 'This Week'}
                    ];
                    
                    // Get fresh access token for task completion
                    const token = await getAccessToken();
                    if (!token) {
                        console.error('Failed to get access token for task completion');
                        return;
                    }

                    // Try to complete the task via API with fresh token
                    for (let taskList of taskLists) {
                        const response = await fetch(`https://www.googleapis.com/tasks/v1/lists/${taskList.id}/tasks/${taskId}`, {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                status: 'completed',
                                completed: new Date().toISOString()
                            })
                        });
                        
                        if (response.ok) {
                            showToast(`‚úÖ Task "${taskTitle}" completed and synced!`);
                            // Remove from view after delay
                            setTimeout(() => {
                                taskItem.style.transition = 'all 0.5s ease';
                                taskItem.style.opacity = '0';
                                taskItem.style.transform = 'translateX(-100%)';
                                setTimeout(() => taskItem.remove(), 500);
                            }, 1500);
                            return;
                        }
                    }
                } catch (error) {
                    console.log('Task sync error:', error);
                    // Still show as completed locally even if sync fails
                }
            }
            
            // Store locally  
            localStorage.setItem(`task_${taskId}`, newStatus ? 'completed' : 'pending');
            showToast(`üìù Task "${taskTitle}" marked as ${newStatus ? 'completed' : 'pending'}!`);
        }

        // Add new task
        function addNewTask() {
            const title = prompt('Enter new task:');
            if (title && title.trim()) {
                const newTaskId = 'new-' + Date.now();
                const taskList = document.getElementById('task-list');
                
                const newTaskHTML = `
                    <div class="task-item" id="task-${newTaskId}" style="border-left: 4px solid #f59e0b;">
                        <div class="task-content">
                            <div style="font-weight: 600;">${title.trim()}</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">New Task ‚Ä¢ Just added</div>
                        </div>
                        <div class="task-actions">
                            <span class="task-checkbox" onclick="completeTask('${newTaskId}', '${title.trim()}')">‚¨ú</span>
                        </div>
                    </div>
                `;
                
                taskList.insertAdjacentHTML('afterbegin', newTaskHTML);
                
                // Animate new task
                const newTask = document.getElementById('task-' + newTaskId);
                newTask.style.transform = 'translateY(-20px)';
                newTask.style.opacity = '0';
                setTimeout(() => {
                    newTask.style.transform = 'translateY(0)';
                    newTask.style.opacity = '1';
                }, 100);
                
                console.log(`Added new task: ${title}`);
            }
        }

        // ============================================
        // HORIZONTAL 3-CARD FLASHCARD SYSTEM
        // ============================================

        // Card data with spaced repetition
        const flashcardData = {
            bible: {
                currentIndex: 0,
                cards: [
                    { prompt: 'Psalm 23:1', answer: '"The Lord is my shepherd; I shall not want."' },
                    { prompt: 'Jeremiah 29:11', answer: '"For I know the plans I have for you," declares the Lord, "plans to prosper you and not to harm you, to give you hope and a future."' },
                    { prompt: 'Philippians 4:13', answer: '"I can do all things through Christ who strengthens me."' }
                ]
            },
            vocab: {
                currentIndex: 0,
                cards: [
                    { prompt: 'Eloquent', answer: 'Fluent or persuasive in speaking or writing', example: '"She delivered an eloquent speech that captivated the entire audience."' },
                    { prompt: 'Articulate', answer: 'Having or showing the ability to speak fluently and coherently', example: '"He gave an articulate presentation on the complex topic."' },
                    { prompt: 'Discern', answer: 'To perceive or recognize something, especially through careful observation', example: '"It\'s difficult to discern the truth from the lies in market analysis."' },
                    { prompt: 'Compelling', answer: 'Evoking interest, attention, or admiration in a powerfully irresistible way', example: '"The data presented a compelling case for expanding into Alberta."' },
                    { prompt: 'Pragmatic', answer: 'Dealing with things sensibly and realistically based on practical considerations', example: '"A pragmatic approach to expansion focuses on validated market demand first."' }
                ]
            },
            facts: {
                currentIndex: 0,
                cards: [
                    { prompt: 'Public Speaking Fear', answer: 'Glossophobia (fear of public speaking) affects approximately 75% of people. It\'s the #1 fear in America, ranked above death.' },
                    { prompt: 'Bitcoin Energy', answer: 'The Bitcoin network consumes roughly 150 TWh of electricity per year - more than some countries like Argentina.' },
                    { prompt: 'Human Brain Power', answer: 'The human brain operates on about 20 watts of power - enough to power a dim lightbulb, yet it outperforms most computers at pattern recognition.' },
                    { prompt: 'Compound Interest', answer: 'If you invested $1,000 at 10% annual return, it would grow to $17,449 in 30 years. Albert Einstein called compound interest the "eighth wonder of the world."' }
                ]
            }
        };

        // XP & Gamification State
        let xpState = JSON.parse(localStorage.getItem('flashcardXP') || '{"xp":325,"level":3,"streak":15,"cardsReviewed":0}');

        // Load saved card data from localStorage
        const savedCards = JSON.parse(localStorage.getItem('flashcardData') || 'null');
        if (savedCards) {
            ['bible', 'vocab', 'facts'].forEach(type => {
                if (savedCards[type] && savedCards[type].cards && savedCards[type].cards.length > 0) {
                    flashcardData[type].cards = savedCards[type].cards;
                }
            });
        }

        // Initialize flashcards on load
        function initFlashcards() {
            ['bible', 'vocab', 'facts'].forEach(type => {
                renderCard(type);
                renderDots(type);
            });
            updateXPDisplay();
        }

        // Render current card content
        function renderCard(type) {
            const data = flashcardData[type];
            const card = data.cards[data.currentIndex];

            document.getElementById(`${type}-prompt`).textContent = card.prompt;
            document.getElementById(`${type}-count`).textContent = `${data.currentIndex + 1} of ${data.cards.length}`;

            // Set answer content
            if (type === 'vocab') {
                document.getElementById('vocab-answer-text').innerHTML = `<strong>Definition:</strong> ${card.answer}`;
                document.getElementById('vocab-answer-example').textContent = card.example || '';
                document.getElementById('vocab-subtitle').textContent = 'Click to see definition & usage';
            } else if (type === 'bible') {
                document.getElementById('bible-answer-text').textContent = card.answer;
            } else {
                document.getElementById('facts-answer-text').textContent = card.answer;
            }

            // Reset answer visibility
            document.getElementById(`${type}-answer`).style.display = 'none';
            document.getElementById(`${type}-sr-buttons`).style.display = 'none';
            document.getElementById(`${type}-toggle-btn`).textContent = 'Show Answer';
            document.getElementById(`${type}-toggle-btn`).style.display = 'block';

            // Update dots
            renderDots(type);
        }

        // Render navigation dots
        function renderDots(type) {
            const data = flashcardData[type];
            const dotsContainer = document.getElementById(`${type}-dots`);
            dotsContainer.innerHTML = '';
            data.cards.forEach((_, i) => {
                const dot = document.createElement('div');
                dot.className = `nav-dot${i === data.currentIndex ? ' active' : ''}`;
                dot.onclick = () => { data.currentIndex = i; renderCard(type); };
                dotsContainer.appendChild(dot);
            });
        }

        // Toggle answer visibility
        function toggleAnswer(type) {
            const answerEl = document.getElementById(`${type}-answer`);
            const btnEl = document.getElementById(`${type}-toggle-btn`);
            const srEl = document.getElementById(`${type}-sr-buttons`);

            if (answerEl.style.display === 'none' || answerEl.style.display === '') {
                answerEl.style.display = 'block';
                srEl.style.display = 'flex';
                btnEl.textContent = 'Hide Answer';
            } else {
                answerEl.style.display = 'none';
                srEl.style.display = 'none';
                btnEl.textContent = 'Show Answer';
            }
        }

        // Navigate between cards
        function navigateCard(type, direction) {
            const data = flashcardData[type];
            data.currentIndex += direction;
            if (data.currentIndex < 0) data.currentIndex = data.cards.length - 1;
            if (data.currentIndex >= data.cards.length) data.currentIndex = 0;
            renderCard(type);
        }

        // Rate card (spaced repetition + XP)
        function rateCard(type, quality) {
            const data = flashcardData[type];
            const card = data.cards[data.currentIndex];

            // Calculate next review
            const intervals = { 1: 1, 2: 2, 3: 4, 4: 14 };
            const nextReview = new Date();
            nextReview.setDate(nextReview.getDate() + (intervals[quality] || 1));

            // Store review data
            const reviewKey = `${type}_${data.currentIndex}`;
            spacedRepetitionData[reviewKey] = {
                lastReview: new Date().toISOString(),
                quality: quality,
                nextReview: nextReview.toISOString(),
                reviewCount: (spacedRepetitionData[reviewKey]?.reviewCount || 0) + 1
            };
            localStorage.setItem('spacedRepetitionData', JSON.stringify(spacedRepetitionData));

            // Award XP based on rating
            const xpRewards = { 1: 5, 2: 10, 3: 20, 4: 35 };
            const xpGained = xpRewards[quality] || 10;
            addXP(xpGained);

            // Visual feedback
            const qualityLabels = { 1: 'Again (1 day)', 2: 'Hard (2 days)', 3: 'Good (4 days)', 4: 'Easy (2 weeks)' };
            showToast(`+${xpGained} XP! ${card.prompt} - Next review: ${qualityLabels[quality]}`);

            // Auto-advance to next card
            setTimeout(() => navigateCard(type, 1), 600);
        }

        // XP System
        function addXP(amount) {
            xpState.xp += amount;
            xpState.cardsReviewed++;

            // Level up check (500 XP per level)
            const xpPerLevel = 500;
            while (xpState.xp >= xpPerLevel) {
                xpState.xp -= xpPerLevel;
                xpState.level++;
                showToast(`üéâ LEVEL UP! You're now Level ${xpState.level}!`);
            }

            localStorage.setItem('flashcardXP', JSON.stringify(xpState));
            updateXPDisplay();
        }

        function updateXPDisplay() {
            document.getElementById('xp-level').textContent = `Level ${xpState.level}`;
            document.getElementById('xp-current').textContent = xpState.xp;
            document.getElementById('xp-bar-fill').style.width = `${(xpState.xp / 500) * 100}%`;
            document.getElementById('streak-display').textContent = `üî• ${xpState.streak} day streak`;
        }

        // Modal functions
        function openModal(type) {
            document.getElementById(`modal-${type}`).classList.add('active');
        }

        function closeModal(type) {
            document.getElementById(`modal-${type}`).classList.remove('active');
        }

        function openTreeModal() {
            document.getElementById('modal-tree').classList.add('active');
        }

        function closeTreeModal() {
            document.getElementById('modal-tree').classList.remove('active');
        }

        // Add new card from modal
        function addCard(type) {
            let newCard;

            if (type === 'bible') {
                const ref = document.getElementById('modal-bible-ref').value.trim();
                const text = document.getElementById('modal-bible-text').value.trim();
                if (!ref || !text) { showToast('Please fill in both fields'); return; }
                newCard = { prompt: ref, answer: text };
                document.getElementById('modal-bible-ref').value = '';
                document.getElementById('modal-bible-text').value = '';
            } else if (type === 'vocab') {
                const word = document.getElementById('modal-vocab-word').value.trim();
                const def = document.getElementById('modal-vocab-def').value.trim();
                const example = document.getElementById('modal-vocab-example').value.trim();
                if (!word || !def) { showToast('Please fill in word and definition'); return; }
                newCard = { prompt: word, answer: def, example: example || '' };
                document.getElementById('modal-vocab-word').value = '';
                document.getElementById('modal-vocab-def').value = '';
                document.getElementById('modal-vocab-example').value = '';
            } else if (type === 'facts') {
                const title = document.getElementById('modal-facts-title').value.trim();
                const text = document.getElementById('modal-facts-text').value.trim();
                if (!title || !text) { showToast('Please fill in both fields'); return; }
                newCard = { prompt: title, answer: text };
                document.getElementById('modal-facts-title').value = '';
                document.getElementById('modal-facts-text').value = '';
            }

            flashcardData[type].cards.push(newCard);

            // Save to localStorage
            localStorage.setItem('flashcardData', JSON.stringify(flashcardData));

            // Navigate to new card
            flashcardData[type].currentIndex = flashcardData[type].cards.length - 1;
            renderCard(type);
            closeModal(type);

            addXP(15);
            showToast(`+15 XP! New ${type === 'bible' ? 'verse' : type === 'vocab' ? 'word' : 'fact'} added!`);
        }

        // Close modals on overlay click
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('active');
            }
        });

        // Save gratitude
        function saveGratitude() {
            const gratitude1 = document.getElementById('gratitude1').value.trim();
            const gratitude2 = document.getElementById('gratitude2').value.trim();
            const gratitude3 = document.getElementById('gratitude3').value.trim();
            
            if (gratitude1 || gratitude2 || gratitude3) {
                const gratitudeData = {
                    date: new Date().toISOString().split('T')[0],
                    items: [gratitude1, gratitude2, gratitude3].filter(item => item),
                    timestamp: new Date().toISOString()
                };
                
                // Store in localStorage
                localStorage.setItem(`gratitude_${gratitudeData.date}`, JSON.stringify(gratitudeData));
                
                // Clear inputs with animation
                [1, 2, 3].forEach(i => {
                    const input = document.getElementById(`gratitude${i}`);
                    input.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        input.value = '';
                        input.style.transform = 'scale(1)';
                    }, 150);
                });
                
                // Show success status
                const statusDiv = document.getElementById('gratitude-status');
                statusDiv.textContent = '‚úÖ Today\'s gratitude saved successfully!';
                statusDiv.style.color = '#22c55e';
                
                setTimeout(() => {
                    statusDiv.textContent = '';
                }, 3000);
                
                console.log('Gratitude saved:', gratitudeData);
            } else {
                const statusDiv = document.getElementById('gratitude-status');
                statusDiv.textContent = '‚ö†Ô∏è Please enter at least one gratitude item';
                statusDiv.style.color = '#f59e0b';
                
                setTimeout(() => {
                    statusDiv.textContent = '';
                }, 3000);
            }
        }

        // Show toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(34, 197, 94, 0.9);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                font-weight: 600;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Load saved spaced repetition data
        function loadSpacedRepetitionData() {
            const saved = localStorage.getItem('spacedRepetitionData');
            if (saved) {
                spacedRepetitionData = JSON.parse(saved);
            }
        }

        // Initialize everything
        function initializeDashboard() {
            console.log('üöÄ Initializing Devon\'s Complete Dashboard...');
            
            updateDate();
            updateFlipClock();
            loadSpacedRepetitionData();
            initFlashcards();

            // Load all live data
            loadWeatherData();
            loadCalendarData();
            loadTasksData();
            loadSwingTrades();
            loadMoonshots();
            loadMacroData();
            loadCryptoIntel();
            
            // Update clock every minute
            setInterval(updateFlipClock, 60000);
            
            // Reload crypto intelligence every 15 minutes, other data every 5 minutes
            setInterval(() => {
                console.log('üîÑ Refreshing live data...');
                loadWeatherData();
                loadCalendarData();
                loadTasksData();
            }, 300000);

            setInterval(() => {
                console.log('üîÑ Refreshing crypto intelligence...');
                loadSwingTrades();
                loadMoonshots();
                loadMacroData();
                loadCryptoIntel();
            }, 900000);
            
            console.log('‚úÖ Dashboard initialization complete!');
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Start when page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);

        // Handle page visibility changes (reload when returning to tab)
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                console.log('üì± Tab became visible - refreshing data...');
                loadWeatherData();
                loadCalendarData();
                loadTasksData();
                loadSwingTrades();
                loadMoonshots();
                loadMacroData();
                loadCryptoIntel();
            }
        });
    </script>
</body>
</html>